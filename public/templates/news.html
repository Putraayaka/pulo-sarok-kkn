{% extends 'base.html' %}

{% block title %}Berita Desa - Website Desa Pulosarok{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-gradient text-white py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center">
            <h1 class="text-4xl md:text-5xl font-bold mb-4 fade-in">Berita Desa</h1>
            <p class="text-xl opacity-90 fade-in">Informasi Terkini dan Berita Terbaru Desa Pulosarok</p>
        </div>
    </div>
</section>

<!-- Featured News -->
<section class="py-16 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
            <h2 class="text-3xl font-bold text-gray-900 mb-4">Berita Utama</h2>
            <p class="text-gray-600">Berita terpenting dan terbaru dari Desa Pulosarok</p>
        </div>
        
        <div id="featured-news" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Featured news will be loaded here -->
        </div>
    </div>
</section>

<!-- Search and Filter Section -->
<section class="py-8 bg-gray-50 border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col lg:flex-row gap-4 items-center justify-between">
            <div class="flex flex-col sm:flex-row gap-4 flex-1">
                <div class="flex-1">
                    <input type="text" id="search-input" placeholder="Cari berita..." 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                </div>
                
                <select id="category-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                    <option value="">Semua Kategori</option>
                    <option value="pemerintahan">Pemerintahan</option>
                    <option value="pembangunan">Pembangunan</option>
                    <option value="sosial">Sosial</option>
                    <option value="ekonomi">Ekonomi</option>
                    <option value="budaya">Budaya</option>
                    <option value="kesehatan">Kesehatan</option>
                    <option value="pendidikan">Pendidikan</option>
                    <option value="lingkungan">Lingkungan</option>
                </select>
                
                <select id="sort-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                    <option value="-tanggal_publikasi">Terbaru</option>
                    <option value="tanggal_publikasi">Terlama</option>
                    <option value="judul">A-Z</option>
                    <option value="-judul">Z-A</option>
                </select>
            </div>
            
            <div class="flex gap-2">
                <button onclick="toggleView('grid')" id="grid-btn" class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors">
                    <i class="fas fa-th-large mr-2"></i>Grid
                </button>
                <button onclick="toggleView('list')" id="list-btn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                    <i class="fas fa-list mr-2"></i>List
                </button>
            </div>
        </div>
    </div>
</section>

<!-- News Grid View -->
<section id="grid-view" class="py-16 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div id="news-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- News grid will be loaded here -->
        </div>
        
        <!-- Pagination -->
        <div id="grid-pagination" class="flex items-center justify-center mt-12">
            <!-- Pagination will be loaded here -->
        </div>
    </div>
</section>

<!-- News List View -->
<section id="list-view" class="py-16 bg-gray-50 hidden">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <div id="news-list" class="space-y-6">
                <!-- News list will be loaded here -->
            </div>
            
            <!-- Pagination -->
            <div id="list-pagination" class="flex items-center justify-between mt-8">
                <!-- Pagination will be loaded here -->
            </div>
        </div>
    </div>
</section>

<!-- News Statistics -->
<section class="py-16 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
            <h2 class="text-3xl font-bold text-gray-900 mb-4">Statistik Berita</h2>
            <p class="text-gray-600">Ringkasan publikasi berita desa</p>
        </div>
        
        <div id="news-stats" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12">
            <!-- Stats will be loaded here -->
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-900 mb-4">Berita per Kategori</h3>
                <canvas id="categoryChart" width="400" height="300"></canvas>
            </div>
            
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-900 mb-4">Publikasi per Bulan</h3>
                <canvas id="monthlyChart" width="400" height="300"></canvas>
            </div>
        </div>
    </div>
</section>

<!-- News Detail Modal -->
<div id="news-modal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-lg max-w-4xl w-full max-h-screen overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-start mb-4">
                    <h2 id="news-modal-title" class="text-2xl font-bold text-gray-900"></h2>
                    <button onclick="closeModal('news-modal')" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div id="news-modal-content">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    class NewsPage {
        constructor() {
            this.currentView = 'grid';
            this.currentPage = 1;
            this.pageSize = 12;
            this.filters = {
                search: '',
                category: '',
                sort: '-tanggal_publikasi'
            };
            this.news = [];
            this.init();
        }
        
        async init() {
            await this.loadFeaturedNews();
            await this.loadNews();
            await this.loadNewsStats();
            this.setupFilters();
        }
        
        setupFilters() {
            document.getElementById('search-input').addEventListener('input', (e) => {
                this.filters.search = e.target.value;
                this.debounceSearch();
            });
            
            document.getElementById('category-filter').addEventListener('change', (e) => {
                this.filters.category = e.target.value;
                this.currentPage = 1;
                this.loadNews();
            });
            
            document.getElementById('sort-filter').addEventListener('change', (e) => {
                this.filters.sort = e.target.value;
                this.currentPage = 1;
                this.loadNews();
            });
        }
        
        debounceSearch() {
            clearTimeout(this.searchTimeout);
            this.searchTimeout = setTimeout(() => {
                this.currentPage = 1;
                this.loadNews();
            }, 500);
        }
        
        async loadFeaturedNews() {
            try {
                const data = await apiCall('/pulosarok/news/news/?featured=true&page_size=2');
                this.renderFeaturedNews(data.results || data || []);
            } catch (error) {
                console.error('Error loading featured news:', error);
            }
        }
        
        renderFeaturedNews(news) {
            const container = document.getElementById('featured-news');
            
            if (news.length === 0) {
                container.innerHTML = '<div class="col-span-2 text-center text-gray-500 py-8">Belum ada berita utama</div>';
                return;
            }
            
            container.innerHTML = news.map((article, index) => `
                <div class="${index === 0 ? 'lg:col-span-1' : ''} bg-white rounded-lg shadow-lg overflow-hidden card-hover cursor-pointer" onclick="showNewsDetail(${article.id})">
                    <div class="${index === 0 ? 'lg:flex' : ''}">
                        <div class="${index === 0 ? 'lg:w-1/2' : ''} aspect-video bg-gray-200">
                            ${article.gambar_utama ? `
                                <img src="${article.gambar_utama}" alt="${article.judul}" class="w-full h-full object-cover">
                            ` : `
                                <div class="w-full h-full flex items-center justify-center text-gray-400">
                                    <i class="fas fa-image text-4xl"></i>
                                </div>
                            `}
                        </div>
                        <div class="${index === 0 ? 'lg:w-1/2' : ''} p-6">
                            <div class="flex items-center justify-between mb-3">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800">
                                    ${article.kategori || 'Umum'}
                                </span>
                                <span class="text-sm text-gray-500">${formatDate(article.tanggal_publikasi)}</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-3 line-clamp-2">${article.judul}</h3>
                            <p class="text-gray-600 mb-4 line-clamp-3">${article.ringkasan || article.konten.substring(0, 150) + '...'}</p>
                            <div class="flex items-center text-sm text-gray-500">
                                <i class="fas fa-user mr-2"></i>
                                <span>${article.penulis || 'Admin Desa'}</span>
                                <span class="mx-2">•</span>
                                <i class="fas fa-eye mr-2"></i>
                                <span>${formatNumber(article.views || 0)} views</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        async loadNews() {
            try {
                let url = `/api/news/?page=${this.currentPage}&page_size=${this.pageSize}&ordering=${this.filters.sort}`;
                
                if (this.filters.search) {
                    url += `&search=${encodeURIComponent(this.filters.search)}`;
                }
                if (this.filters.category) {
                    url += `&kategori=${this.filters.category}`;
                }
                
                const data = await apiCall(url);
                this.news = data.news || data.results || [];
                
                if (this.currentView === 'grid') {
                    this.renderNewsGrid();
                    this.renderPagination(data, 'grid-pagination');
                } else {
                    this.renderNewsList();
                    this.renderPagination(data, 'list-pagination');
                }
            } catch (error) {
                console.error('Error loading news:', error);
                const container = this.currentView === 'grid' ? 
                    document.getElementById('news-grid') : 
                    document.getElementById('news-list');
                container.innerHTML = '<div class="text-center text-gray-500 py-8">Gagal memuat berita</div>';
            }
        }
        
        renderNewsGrid() {
            const container = document.getElementById('news-grid');
            
            if (this.news.length === 0) {
                container.innerHTML = '<div class="col-span-3 text-center text-gray-500 py-8">Tidak ada berita ditemukan</div>';
                return;
            }
            
            container.innerHTML = this.news.map(article => `
                <div class="bg-white rounded-lg shadow-lg overflow-hidden card-hover cursor-pointer" onclick="showNewsDetail(${article.id})">
                    <div class="aspect-video bg-gray-200">
                        ${article.gambar_utama ? `
                            <img src="${article.gambar_utama}" alt="${article.judul}" class="w-full h-full object-cover">
                        ` : `
                            <div class="w-full h-full flex items-center justify-center text-gray-400">
                                <i class="fas fa-image text-3xl"></i>
                            </div>
                        `}
                    </div>
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-3">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800">
                                ${article.kategori || 'Umum'}
                            </span>
                            <span class="text-sm text-gray-500">${formatDate(article.tanggal_publikasi)}</span>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2 line-clamp-2">${article.judul}</h3>
                        <p class="text-gray-600 text-sm mb-4 line-clamp-3">${article.ringkasan || article.konten.substring(0, 100) + '...'}</p>
                        <div class="flex items-center justify-between text-sm text-gray-500">
                            <div class="flex items-center">
                                <i class="fas fa-user mr-2"></i>
                                <span>${article.penulis || 'Admin Desa'}</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-eye mr-2"></i>
                                <span>${formatNumber(article.views || 0)}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        renderNewsList() {
            const container = document.getElementById('news-list');
            
            if (this.news.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">Tidak ada berita ditemukan</div>';
                return;
            }
            
            container.innerHTML = this.news.map(article => `
                <div class="flex gap-6 p-6 border border-gray-200 rounded-lg hover:shadow-md transition-shadow cursor-pointer" onclick="showNewsDetail(${article.id})">
                    <div class="w-48 h-32 bg-gray-200 rounded-lg overflow-hidden flex-shrink-0">
                        ${article.gambar_utama ? `
                            <img src="${article.gambar_utama}" alt="${article.judul}" class="w-full h-full object-cover">
                        ` : `
                            <div class="w-full h-full flex items-center justify-center text-gray-400">
                                <i class="fas fa-image text-2xl"></i>
                            </div>
                        `}
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center justify-between mb-3">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800">
                                ${article.kategori || 'Umum'}
                            </span>
                            <span class="text-sm text-gray-500">${formatDate(article.tanggal_publikasi)}</span>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-2 line-clamp-2">${article.judul}</h3>
                        <p class="text-gray-600 mb-4 line-clamp-3">${article.ringkasan || article.konten.substring(0, 200) + '...'}</p>
                        <div class="flex items-center justify-between text-sm text-gray-500">
                            <div class="flex items-center gap-4">
                                <div class="flex items-center">
                                    <i class="fas fa-user mr-2"></i>
                                    <span>${article.penulis || 'Admin Desa'}</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-eye mr-2"></i>
                                    <span>${formatNumber(article.views || 0)} views</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-comment mr-2"></i>
                                    <span>${formatNumber(article.comments_count || 0)} komentar</span>
                                </div>
                            </div>
                            <button class="text-primary-600 hover:text-primary-800 font-medium">
                                Baca Selengkapnya <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        renderPagination(data, containerId) {
            const container = document.getElementById(containerId);
            const totalPages = Math.ceil((data.count || 0) / this.pageSize);
            
            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }
            
            const isListView = containerId === 'list-pagination';
            
            if (isListView) {
                container.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="text-sm text-gray-700">
                            Menampilkan ${((this.currentPage - 1) * this.pageSize) + 1} - ${Math.min(this.currentPage * this.pageSize, data.count)} dari ${data.count} berita
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="newsPage.changePage(${this.currentPage - 1})" 
                                    ${this.currentPage === 1 ? 'disabled' : ''} 
                                    class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                                Sebelumnya
                            </button>
                            <span class="px-3 py-2 text-sm font-medium text-gray-700">
                                Halaman ${this.currentPage} dari ${totalPages}
                            </span>
                            <button onclick="newsPage.changePage(${this.currentPage + 1})" 
                                    ${this.currentPage === totalPages ? 'disabled' : ''} 
                                    class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                                Selanjutnya
                            </button>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="flex justify-center space-x-2">
                        <button onclick="newsPage.changePage(${this.currentPage - 1})" 
                                ${this.currentPage === 1 ? 'disabled' : ''} 
                                class="px-4 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-chevron-left mr-2"></i>Sebelumnya
                        </button>
                        <span class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md">
                            ${this.currentPage} / ${totalPages}
                        </span>
                        <button onclick="newsPage.changePage(${this.currentPage + 1})" 
                                ${this.currentPage === totalPages ? 'disabled' : ''} 
                                class="px-4 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                            Selanjutnya<i class="fas fa-chevron-right ml-2"></i>
                        </button>
                    </div>
                `;
            }
        }
        
        changePage(page) {
            if (page < 1) return;
            this.currentPage = page;
            this.loadNews();
        }
        
        async loadNewsStats() {
            try {
                const data = await apiCall('/api/stats/');
                this.renderNewsStats(data);
                this.renderCategoryChart(data);
                this.renderMonthlyChart(data);
            } catch (error) {
                console.error('Error loading news stats:', error);
            }
        }
        
        renderNewsStats(data) {
            const stats = data.stats || {};
            const container = document.getElementById('news-stats');
            
            const statsData = [
                { icon: 'fas fa-newspaper', label: 'Total Berita', value: stats.total || 0, color: 'blue' },
                { icon: 'fas fa-calendar-day', label: 'Bulan Ini', value: stats.this_month || 0, color: 'green' },
                { icon: 'fas fa-eye', label: 'Total Views', value: stats.total_views || 0, color: 'purple' },
                { icon: 'fas fa-comment', label: 'Total Komentar', value: stats.total_comments || 0, color: 'orange' }
            ];
            
            container.innerHTML = statsData.map(stat => `
                <div class="bg-white rounded-lg shadow-lg p-6 text-center card-hover">
                    <div class="w-16 h-16 bg-${stat.color}-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="${stat.icon} text-${stat.color}-600 text-2xl"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-gray-900 mb-2">${formatNumber(stat.value)}</h3>
                    <p class="text-gray-600">${stat.label}</p>
                </div>
            `).join('');
        }
        
        renderCategoryChart(data) {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            const categories = data.categories || {};
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categories),
                    datasets: [{
                        data: Object.values(categories),
                        backgroundColor: [
                            '#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#06B6D4', '#84CC16', '#F97316'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        renderMonthlyChart(data) {
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            const monthly = data.monthly || {};
            
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
            const monthlyData = months.map((month, index) => monthly[index + 1] || 0);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Jumlah Berita',
                        data: monthlyData,
                        backgroundColor: '#0EA5E9',
                        borderColor: '#0284C7',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
    }
    
    function toggleView(view) {
        const gridView = document.getElementById('grid-view');
        const listView = document.getElementById('list-view');
        const gridBtn = document.getElementById('grid-btn');
        const listBtn = document.getElementById('list-btn');
        
        if (view === 'grid') {
            gridView.classList.remove('hidden');
            listView.classList.add('hidden');
            gridBtn.classList.add('bg-primary-600', 'text-white');
            gridBtn.classList.remove('bg-gray-200', 'text-gray-700');
            listBtn.classList.add('bg-gray-200', 'text-gray-700');
            listBtn.classList.remove('bg-primary-600', 'text-white');
        } else {
            gridView.classList.add('hidden');
            listView.classList.remove('hidden');
            listBtn.classList.add('bg-primary-600', 'text-white');
            listBtn.classList.remove('bg-gray-200', 'text-gray-700');
            gridBtn.classList.add('bg-gray-200', 'text-gray-700');
            gridBtn.classList.remove('bg-primary-600', 'text-white');
        }
        
        newsPage.currentView = view;
        newsPage.loadNews();
    }
    
    async function showNewsDetail(newsId) {
        try {
            const article = await apiCall(`/pulosarok/news/news/${newsId}/`);
            
            document.getElementById('news-modal-title').textContent = article.judul;
            document.getElementById('news-modal-content').innerHTML = `
                <div class="space-y-6">
                    ${article.gambar_utama ? `
                        <div class="aspect-video bg-gray-200 rounded-lg overflow-hidden">
                            <img src="${article.gambar_utama}" alt="${article.judul}" class="w-full h-full object-cover">
                        </div>
                    ` : ''}
                    
                    <div class="flex items-center justify-between text-sm text-gray-500 border-b pb-4">
                        <div class="flex items-center gap-4">
                            <div class="flex items-center">
                                <i class="fas fa-user mr-2"></i>
                                <span>${article.penulis || 'Admin Desa'}</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-calendar mr-2"></i>
                                <span>${formatDate(article.tanggal_publikasi)}</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-eye mr-2"></i>
                                <span>${formatNumber(article.views || 0)} views</span>
                            </div>
                        </div>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800">
                            ${article.kategori || 'Umum'}
                        </span>
                    </div>
                    
                    ${article.ringkasan ? `
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-gray-900 mb-2">Ringkasan</h3>
                            <p class="text-gray-700">${article.ringkasan}</p>
                        </div>
                    ` : ''}
                    
                    <div class="prose max-w-none">
                        ${article.konten || 'Konten tidak tersedia.'}
                    </div>
                    
                    ${article.tags && article.tags.length > 0 ? `
                        <div class="border-t pt-4">
                            <h4 class="font-semibold text-gray-900 mb-2">Tags</h4>
                            <div class="flex flex-wrap gap-2">
                                ${article.tags.map(tag => `
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                        ${tag}
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="border-t pt-4">
                        <div class="flex items-center justify-between">
                            <div class="text-sm text-gray-500">
                                Terakhir diperbarui: ${formatDate(article.tanggal_update || article.tanggal_publikasi)}
                            </div>
                            <div class="flex gap-2">
                                <button onclick="shareNews('${article.judul}', window.location.href)" class="text-primary-600 hover:text-primary-800">
                                    <i class="fas fa-share-alt mr-1"></i>Bagikan
                                </button>
                                <button onclick="printNews()" class="text-gray-600 hover:text-gray-800">
                                    <i class="fas fa-print mr-1"></i>Cetak
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            openModal('news-modal');
            
            // Increment view count
            apiCall(`/pulosarok/news/news/${newsId}/view/`, 'POST').catch(console.error);
        } catch (error) {
            console.error('Error loading news detail:', error);
        }
    }
    
    function shareNews(title, url) {
        if (navigator.share) {
            navigator.share({
                title: title,
                url: url
            }).catch(console.error);
        } else {
            // Fallback to copying URL
            navigator.clipboard.writeText(url).then(() => {
                alert('Link berhasil disalin!');
            }).catch(() => {
                alert('Gagal menyalin link');
            });
        }
    }
    
    function printNews() {
        window.print();
    }
    
    // Initialize news page
    let newsPage;
    document.addEventListener('DOMContentLoaded', function() {
        newsPage = new NewsPage();
    });
</script>
{% endblock %}
