{% extends 'admin/base.html' %}

{% block title %}Input Data Disabilitas{% endblock %}

{% block page_title %}Input Data Disabilitas{% endblock %}

{% block content %}
<div class="p-4 sm:p-6 space-y-6">
    <!-- Header Actions -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0">
        <div>
            <h2 class="text-lg font-semibold text-gray-900">Data Disabilitas</h2>
            <p class="text-sm text-gray-500">Kelola data penyandang disabilitas</p>
        </div>
        
        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 w-full sm:w-auto">
            <!-- Export/Import Buttons -->
            <div class="flex space-x-2">
                <button onclick="exportData()" 
                        class="flex-1 sm:flex-none px-3 py-2 bg-green-600 text-white text-sm rounded-md hover:bg-green-700 focus:ring-2 focus:ring-green-500">
                    <i class="fas fa-download mr-1"></i>Export
                </button>
                <button onclick="importData()" 
                        class="flex-1 sm:flex-none px-3 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 focus:ring-2 focus:ring-blue-500">
                    <i class="fas fa-upload mr-1"></i>Import
                </button>
            </div>
            
            <!-- Add Button -->
            <button onclick="openCreateModal()" 
                    class="w-full sm:w-auto px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 focus:ring-2 focus:ring-primary-500">
                <i class="fas fa-plus mr-2"></i>Tambah Data
            </button>
        </div>
    </div>

    <!-- Tabs -->
    <div class="bg-white rounded-lg shadow">
        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-8 px-6" aria-label="Tabs">
                <button class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm tab-button active" data-tab="type">
                    <i class="fas fa-tags mr-2"></i>Jenis Disabilitas
                </button>
                <button class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm tab-button" data-tab="data">
                    <i class="fas fa-wheelchair mr-2"></i>Data Disabilitas
                </button>
            </nav>
        </div>

        <!-- Tab Content -->
        <div class="p-6">
            <!-- Jenis Disabilitas Tab -->
            <div id="type-tab" class="tab-content">
                <!-- Search and Filter -->
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                        <div class="flex-1">
                            <input type="text" id="type-search" placeholder="Cari jenis disabilitas..." 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500">
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="clearTypeSearch()" 
                                    class="px-3 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50">
                                <i class="fas fa-times"></i>
                            </button>
                            <button onclick="refreshTypeData()" 
                                    class="px-3 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button onclick="openCreateTypeModal()" 
                                    class="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 focus:ring-2 focus:ring-primary-500">
                                <i class="fas fa-plus mr-2"></i>Tambah Jenis
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Type Table -->
                <div class="bg-white rounded-lg border overflow-hidden">
                    <!-- Bulk Actions for Type -->
                    <div id="type-bulk-actions" class="hidden bg-blue-50 px-4 py-3 border-b">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-blue-700">
                                <span id="type-selected-count">0</span> item dipilih
                            </span>
                            <div class="flex space-x-2">
                                <button onclick="bulkDeleteType()" 
                                        class="px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700">
                                    <i class="fas fa-trash mr-1"></i>Hapus
                                </button>
                                <button onclick="clearTypeSelection()" 
                                        class="px-3 py-1 bg-gray-600 text-white text-sm rounded hover:bg-gray-700">
                                    Batal
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Mobile Card View for Type -->
                    <div id="type-mobile-view" class="block sm:hidden">
                        <div id="type-mobile-cards-container" class="divide-y divide-gray-200">
                            <!-- Dynamic content for mobile -->
                        </div>
                    </div>

                    <!-- Desktop Table View for Type -->
                    <div id="type-desktop-view" class="hidden sm:block overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left">
                                        <input type="checkbox" id="type-select-all" class="rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Deskripsi</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Kasus</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="type-table-body" class="bg-white divide-y divide-gray-200">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Loading State for Type -->
                    <div id="type-loading" class="hidden p-8 text-center">
                        <i class="fas fa-spinner fa-spin text-2xl text-gray-400"></i>
                        <p class="mt-2 text-gray-500">Memuat data...</p>
                    </div>

                    <!-- Empty State for Type -->
                    <div id="type-empty-state" class="hidden p-8 text-center">
                        <i class="fas fa-tags text-4xl text-gray-300 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Belum ada jenis disabilitas</h3>
                        <p class="text-gray-500 mb-4">Mulai dengan menambahkan jenis disabilitas pertama</p>
                        <button onclick="openCreateTypeModal()" 
                                class="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700">
                            <i class="fas fa-plus mr-2"></i>Tambah Jenis
                        </button>
                    </div>
                </div>
            </div>

            <!-- Data Disabilitas Tab -->
            <div id="data-tab" class="tab-content hidden">
                <!-- Search and Filter for Data -->
                <div class="mb-6">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="lg:col-span-2">
                            <input type="text" id="data-search" placeholder="Cari nama, NIK, atau jenis disabilitas..." 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500">
                        </div>
                        <div>
                            <select id="type-filter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500">
                                <option value="">Semua Jenis</option>
                            </select>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="clearDataSearch()" 
                                    class="flex-1 px-3 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50">
                                <i class="fas fa-times"></i>
                            </button>
                            <button onclick="refreshDataData()" 
                                    class="flex-1 px-3 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Data Table -->
                <div class="bg-white rounded-lg border overflow-hidden">
                    <!-- Bulk Actions for Data -->
                    <div id="data-bulk-actions" class="hidden bg-blue-50 px-4 py-3 border-b">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-blue-700">
                                <span id="data-selected-count">0</span> item dipilih
                            </span>
                            <div class="flex space-x-2">
                                <button onclick="bulkDeleteData()" 
                                        class="px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700">
                                    <i class="fas fa-trash mr-1"></i>Hapus
                                </button>
                                <button onclick="clearDataSelection()" 
                                        class="px-3 py-1 bg-gray-600 text-white text-sm rounded hover:bg-gray-700">
                                    Batal
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Mobile Card View for Data -->
                    <div id="data-mobile-view" class="block sm:hidden">
                        <div id="data-mobile-cards-container" class="divide-y divide-gray-200">
                            <!-- Dynamic content for mobile -->
                        </div>
                    </div>

                    <!-- Desktop Table View for Data -->
                    <div id="data-desktop-view" class="hidden sm:block overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left">
                                        <input type="checkbox" id="data-select-all" class="rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Penduduk</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NIK</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jenis Disabilitas</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tingkat</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Perlu Bantuan</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="data-table-body" class="bg-white divide-y divide-gray-200">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Loading State for Data -->
                    <div id="data-loading" class="hidden p-8 text-center">
                        <i class="fas fa-spinner fa-spin text-2xl text-gray-400"></i>
                        <p class="mt-2 text-gray-500">Memuat data...</p>
                    </div>

                    <!-- Empty State for Data -->
                    <div id="data-empty-state" class="hidden p-8 text-center">
                        <i class="fas fa-wheelchair text-4xl text-gray-300 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Belum ada data disabilitas</h3>
                        <p class="text-gray-500 mb-4">Mulai dengan menambahkan data disabilitas pertama</p>
                        <button onclick="openCreateModal()" 
                                class="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700">
                            <i class="fas fa-plus mr-2"></i>Tambah Data
                        </button>
                    </div>
                </div>

                <!-- Pagination for Data -->
                <div id="data-pagination" class="flex flex-col sm:flex-row items-center justify-between space-y-4 sm:space-y-0 mt-6">
                    <div class="flex flex-col sm:flex-row items-center text-sm text-gray-700 space-y-2 sm:space-y-0 sm:space-x-4">
                        <span id="data-pagination-info">Menampilkan 0 dari 0 data</span>
                        <span id="data-total-info" class="text-primary-600 font-medium">Total Data: 0 (Tahun 2025)</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button id="data-prev-btn" onclick="previousDataPage()" 
                                class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50" disabled>
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <div id="data-page-numbers" class="flex space-x-1"></div>
                        <button id="data-next-btn" onclick="nextDataPage()" 
                                class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50" disabled>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create/Edit Type Modal -->
<div id="type-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-2/3 lg:w-1/2 xl:w-1/3 shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex justify-between items-center mb-4">
                <h3 id="type-modal-title" class="text-lg font-medium text-gray-900">Tambah Jenis Disabilitas</h3>
                <button onclick="closeTypeModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="type-form" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nama Jenis *</label>
                        <input type="text" name="name" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Kode *</label>
                        <input type="text" name="code" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Deskripsi</label>
                    <textarea name="description" rows="3" 
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500"></textarea>
                </div>
                <div>
                    <label class="flex items-center">
                        <input type="checkbox" name="is_active" checked 
                               class="rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                        <span class="ml-2 text-sm text-gray-700">Aktif</span>
                    </label>
                </div>
                
                <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3 pt-4 border-t">
                    <button type="button" onclick="closeTypeModal()" 
                            class="w-full sm:w-auto px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">
                        Batal
                    </button>
                    <button type="submit" 
                            class="w-full sm:w-auto px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700">
                        <i class="fas fa-save mr-2"></i>Simpan
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Create/Edit Data Modal -->
<div id="data-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 xl:w-1/3 shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex justify-between items-center mb-4">
                <h3 id="data-modal-title" class="text-lg font-medium text-gray-900">Tambah Data Disabilitas</h3>
                <button onclick="closeDataModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="data-form" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Penduduk *</label>
                        <select name="penduduk" required id="penduduk-select"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500">
                            <option value="">Pilih Penduduk</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Jenis Disabilitas *</label>
                        <select name="disability_type" required id="disability-type-select"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500">
                            <option value="">Pilih Jenis</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tingkat Keparahan *</label>
                        <select name="severity" required id="severity-select"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500">
                            <option value="">Pilih Tingkat</option>
                            <option value="RINGAN">Ringan</option>
                            <option value="SEDANG">Sedang</option>
                            <option value="BERAT">Berat</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal Diagnosis</label>
                        <input type="date" name="diagnosis_date" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Deskripsi</label>
                    <textarea name="description" rows="3" 
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500"></textarea>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="flex items-center">
                            <input type="checkbox" name="needs_assistance" 
                                   class="rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                            <span class="ml-2 text-sm text-gray-700">Memerlukan Bantuan</span>
                        </label>
                    </div>
                    <div>
                        <label class="flex items-center">
                            <input type="checkbox" name="is_active" checked 
                                   class="rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                            <span class="ml-2 text-sm text-gray-700">Aktif</span>
                        </label>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3 pt-4 border-t">
                    <button type="button" onclick="closeDataModal()" 
                            class="w-full sm:w-auto px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">
                        Batal
                    </button>
                    <button type="submit" 
                            class="w-full sm:w-auto px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700">
                        <i class="fas fa-save mr-2"></i>Simpan
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="delete-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 lg:w-1/3 shadow-lg rounded-md bg-white">
        <div class="mt-3 text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
                <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">Konfirmasi Hapus</h3>
            <p class="text-sm text-gray-500 mb-6">Apakah Anda yakin ingin menghapus data ini? Tindakan ini tidak dapat dibatalkan.</p>
            
            <div class="flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-3">
                <button onclick="closeDeleteModal()" 
                        class="w-full sm:w-auto px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">
                    Batal
                </button>
                <button id="confirm-delete-btn" 
                        class="w-full sm:w-auto px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
                    <i class="fas fa-trash mr-2"></i>Hapus
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Import Modal -->
<div id="import-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-2/3 lg:w-1/2 shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-gray-900">Import Data Disabilitas</h3>
                <button onclick="closeImportModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="import-form" enctype="multipart/form-data">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">File Excel/CSV</label>
                        <input type="file" name="file" accept=".xlsx,.xls,.csv" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500">
                        <p class="mt-1 text-sm text-gray-500">Format yang didukung: .xlsx, .xls, .csv</p>
                    </div>
                    
                    <div class="bg-yellow-50 p-4 rounded-md">
                        <h4 class="text-sm font-medium text-yellow-800 mb-2">Format File:</h4>
                        <p class="text-sm text-yellow-700">Kolom yang diperlukan: penduduk__nik, penduduk__name, disability_type__name, severity, description, diagnosis_date, needs_assistance</p>
                        <button type="button" onclick="downloadTemplate()" class="mt-2 text-sm text-primary-600 hover:text-primary-800">
                            <i class="fas fa-download mr-1"></i>Download Template
                        </button>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3 pt-4 border-t mt-6">
                    <button type="button" onclick="closeImportModal()" 
                            class="w-full sm:w-auto px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">
                        Batal
                    </button>
                    <button type="submit" 
                            class="w-full sm:w-auto px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700">
                        <i class="fas fa-upload mr-2"></i>Import
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Global variables
let currentTab = 'type';
let currentPage = 1;
let currentDataPage = 1;
let currentEditId = null;
let currentDeleteId = null;
let currentDeleteType = null;
let typeSelectedItems = new Set();
let dataSelectedItems = new Set();
let disabilityTypes = [];
let pendudukList = [];
let totalDataItems = 0;
const itemsPerPage = 10;

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    loadDropdownData();
    loadTypeData();
    setupEventListeners();
});

function setupEventListeners() {
    // Tab switching
    document.querySelectorAll('.tab-button').forEach(button => {
        button.addEventListener('click', function() {
            switchTab(this.getAttribute('data-tab'));
        });
    });
    
    // Search handlers
    document.getElementById('type-search').addEventListener('input', debounce(() => {
        loadTypeData();
    }, 300));
    
    document.getElementById('data-search').addEventListener('input', debounce(() => {
        currentDataPage = 1;
        loadDisabilitasData();
    }, 300));
    
    document.getElementById('type-filter').addEventListener('change', () => {
        currentDataPage = 1;
        loadDisabilitasData();
    });
    
    // Select all checkboxes
    document.getElementById('type-select-all').addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('.type-checkbox');
        checkboxes.forEach(cb => {
            cb.checked = this.checked;
            if (this.checked) {
                typeSelectedItems.add(cb.value);
            } else {
                typeSelectedItems.delete(cb.value);
            }
        });
        updateTypeBulkActions();
    });
    
    document.getElementById('data-select-all').addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('.data-checkbox');
        checkboxes.forEach(cb => {
            cb.checked = this.checked;
            if (this.checked) {
                dataSelectedItems.add(cb.value);
            } else {
                dataSelectedItems.delete(cb.value);
            }
        });
        updateDataBulkActions();
    });
    
    // Form submissions
    document.getElementById('type-form').addEventListener('submit', function(e) {
        e.preventDefault();
        saveTypeData();
    });
    
    document.getElementById('data-form').addEventListener('submit', function(e) {
        e.preventDefault();
        saveData();
    });
    
    // Import form
    document.getElementById('import-form').addEventListener('submit', function(e) {
        e.preventDefault();
        handleImport();
    });
}

function loadDropdownData() {
    // Load disability types for filter and form
    fetch(`{% url "references:disabilitas_type_list" %}`)
        .then(response => response.json())
        .then(data => {
            disabilityTypes = data.results;
            
            // Populate filter dropdown
            const filterSelect = document.getElementById('type-filter');
            filterSelect.innerHTML = '<option value="">Semua Jenis</option>';
            data.results.forEach(type => {
                filterSelect.innerHTML += `<option value="${type.id}">${type.name}</option>`;
            });
            
            // Populate form dropdown
            const formSelect = document.getElementById('disability-type-select');
            formSelect.innerHTML = '<option value="">Pilih Jenis</option>';
            data.results.forEach(type => {
                formSelect.innerHTML += `<option value="${type.id}">${type.name}</option>`;
            });
        });
    
    // Load penduduk for form
    fetch(`{% url "references:penduduk_list" %}?per_page=1000`)
        .then(response => response.json())
        .then(data => {
            pendudukList = data.results;
            
            const formSelect = document.getElementById('penduduk-select');
            formSelect.innerHTML = '<option value="">Pilih Penduduk</option>';
            data.results.forEach(penduduk => {
                formSelect.innerHTML += `<option value="${penduduk.id}">${penduduk.name} (${penduduk.nik})</option>`;
            });
        });
}

function switchTab(tabName) {
    currentTab = tabName;
    
    // Update tab buttons
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('border-primary-500', 'text-primary-600', 'active');
        button.classList.add('border-transparent', 'text-gray-500');
    });
    
    document.querySelector(`[data-tab="${tabName}"]`).classList.remove('border-transparent', 'text-gray-500');
    document.querySelector(`[data-tab="${tabName}"]`).classList.add('border-primary-500', 'text-primary-600', 'active');
    
    // Show/hide tab content
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
    });
    
    document.getElementById(`${tabName}-tab`).classList.remove('hidden');
    
    // Load appropriate data
    if (tabName === 'type') {
        loadTypeData();
    } else {
        loadDisabilitasData();
    }
}

function loadTypeData() {
    showTypeLoading();
    const search = document.getElementById('type-search').value;
    const url = `{% url "references:disabilitas_type_list" %}?search=${encodeURIComponent(search)}`;
    
    fetch(url)
        .then(response => response.json())
        .then(data => {
            hideTypeLoading();
            if (data.results && data.results.length > 0) {
                renderTypeData(data.results);
                hideTypeEmptyState();
            } else {
                showTypeEmptyState();
            }
        })
        .catch(error => {
            hideTypeLoading();
            console.error('Error loading type data:', error);
            showToast('Terjadi kesalahan saat memuat data', 'error');
        });
}

function loadDisabilitasData() {
    showDataLoading();
    const search = document.getElementById('data-search').value;
    const typeId = document.getElementById('type-filter').value;
    let url = `{% url "references:disabilitas_data_list" %}?page=${currentDataPage}&search=${encodeURIComponent(search)}`;
    if (typeId) {
        url += `&type_id=${typeId}`;
    }
    
    fetch(url)
        .then(response => response.json())
        .then(data => {
            hideDataLoading();
            totalDataItems = data.pagination ? data.pagination.total_items : (data.count || 0);
            if (data.results && data.results.length > 0) {
                renderDataData(data.results);
                updateDataPagination(data.pagination || {});
                hideDataEmptyState();
            } else {
                showDataEmptyState();
                updateDataPagination({ total_items: 0, current_page: 1, has_previous: false, has_next: false });
            }
        })
        .catch(error => {
            hideDataLoading();
            console.error('Error loading data:', error);
            showToast('Terjadi kesalahan saat memuat data', 'error');
        });
}

function renderTypeData(data) {
    renderTypeDesktopView(data);
    renderTypeMobileView(data);
}

function renderTypeDesktopView(data) {
    const tbody = document.getElementById('type-table-body');
    tbody.innerHTML = '';
    
    data.forEach(item => {
        const row = `
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-4">
                    <input type="checkbox" class="type-checkbox rounded border-gray-300 text-primary-600 focus:ring-primary-500" 
                           value="${item.id}" onchange="toggleTypeSelection(this)">
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-medium text-gray-900">${item.name}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm text-gray-900">${item.code}</div>
                </td>
                <td class="px-6 py-4">
                    <div class="text-sm text-gray-900">${item.description || '-'}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm text-gray-900">${item.total_cases}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${item.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                        ${item.is_active ? 'Aktif' : 'Tidak Aktif'}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <div class="flex space-x-2">
                        <button onclick="editTypeItem(${item.id})" class="text-primary-600 hover:text-primary-900" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteTypeItem(${item.id})" class="text-red-600 hover:text-red-900" title="Hapus">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
        `;
        tbody.insertAdjacentHTML('beforeend', row);
    });
}

function renderTypeMobileView(data) {
    const container = document.getElementById('type-mobile-cards-container');
    container.innerHTML = '';
    
    data.forEach(item => {
        const card = `
            <div class="p-4 hover:bg-gray-50">
                <div class="flex items-start justify-between">
                    <div class="flex items-start space-x-3">
                        <input type="checkbox" class="type-checkbox mt-1 rounded border-gray-300 text-primary-600 focus:ring-primary-500" 
                               value="${item.id}" onchange="toggleTypeSelection(this)">
                        <div class="flex-1">
                            <h3 class="text-sm font-medium text-gray-900">${item.name}</h3>
                            <p class="text-sm text-gray-500">Kode: ${item.code}</p>
                            <p class="text-sm text-gray-500">${item.description || '-'}</p>
                            <div class="mt-2 space-y-1">
                                <p class="text-xs text-gray-600">Total kasus: ${item.total_cases}</p>
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${item.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                    ${item.is_active ? 'Aktif' : 'Tidak Aktif'}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="editTypeItem(${item.id})" class="text-primary-600 hover:text-primary-900 p-2" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteTypeItem(${item.id})" class="text-red-600 hover:text-red-900 p-2" title="Hapus">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        `;
        container.insertAdjacentHTML('beforeend', card);
    });
}

function renderDataData(data) {
    renderDataDesktopView(data);
    renderDataMobileView(data);
}

function renderDataDesktopView(data) {
    const tbody = document.getElementById('data-table-body');
    tbody.innerHTML = '';
    
    data.forEach(item => {
        const row = `
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-4">
                    <input type="checkbox" class="data-checkbox rounded border-gray-300 text-primary-600 focus:ring-primary-500" 
                           value="${item.id}" onchange="toggleDataSelection(this)">
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-medium text-gray-900">${item.penduduk_name}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm text-gray-900">${item.penduduk_nik}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm text-gray-900">${item.disability_type}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm text-gray-900">${item.severity}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    ${item.needs_assistance ? '<span class="text-red-600">Ya</span>' : '<span class="text-green-600">Tidak</span>'}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <div class="flex space-x-2">
                        <button onclick="editDataItem(${item.id})" class="text-primary-600 hover:text-primary-900" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteDataItem(${item.id})" class="text-red-600 hover:text-red-900" title="Hapus">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
        `;
        tbody.insertAdjacentHTML('beforeend', row);
    });
}

function renderDataMobileView(data) {
    const container = document.getElementById('data-mobile-cards-container');
    container.innerHTML = '';
    
    data.forEach(item => {
        const card = `
            <div class="p-4 hover:bg-gray-50">
                <div class="flex items-start justify-between">
                    <div class="flex items-start space-x-3">
                        <input type="checkbox" class="data-checkbox mt-1 rounded border-gray-300 text-primary-600 focus:ring-primary-500" 
                               value="${item.id}" onchange="toggleDataSelection(this)">
                        <div class="flex-1">
                            <h3 class="text-sm font-medium text-gray-900">${item.penduduk_name}</h3>
                            <p class="text-sm text-gray-500">NIK: ${item.penduduk_nik}</p>
                            <p class="text-sm text-gray-500">Jenis: ${item.disability_type}</p>
                            <div class="mt-2 space-y-1">
                                <p class="text-xs text-gray-600">Tingkat: ${item.severity}</p>
                                <p class="text-xs text-gray-600">Perlu bantuan: ${item.needs_assistance ? 'Ya' : 'Tidak'}</p>
                            </div>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="editDataItem(${item.id})" class="text-primary-600 hover:text-primary-900 p-2" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteDataItem(${item.id})" class="text-red-600 hover:text-red-900 p-2" title="Hapus">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        `;
        container.insertAdjacentHTML('beforeend', card);
    });
}

// Selection and bulk actions
function toggleTypeSelection(checkbox) {
    if (checkbox.checked) {
        typeSelectedItems.add(checkbox.value);
    } else {
        typeSelectedItems.delete(checkbox.value);
    }
    updateTypeBulkActions();
}

function toggleDataSelection(checkbox) {
    if (checkbox.checked) {
        dataSelectedItems.add(checkbox.value);
    } else {
        dataSelectedItems.delete(checkbox.value);
    }
    updateDataBulkActions();
}

function updateTypeBulkActions() {
    const bulkActions = document.getElementById('type-bulk-actions');
    const selectedCount = document.getElementById('type-selected-count');
    
    if (typeSelectedItems.size > 0) {
        bulkActions.classList.remove('hidden');
        selectedCount.textContent = typeSelectedItems.size;
    } else {
        bulkActions.classList.add('hidden');
    }
}

function updateDataBulkActions() {
    const bulkActions = document.getElementById('data-bulk-actions');
    const selectedCount = document.getElementById('data-selected-count');
    
    if (dataSelectedItems.size > 0) {
        bulkActions.classList.remove('hidden');
        selectedCount.textContent = dataSelectedItems.size;
    } else {
        bulkActions.classList.add('hidden');
    }
}

function clearTypeSelection() {
    typeSelectedItems.clear();
    document.querySelectorAll('.type-checkbox').forEach(cb => cb.checked = false);
    document.getElementById('type-select-all').checked = false;
    updateTypeBulkActions();
}

function clearDataSelection() {
    dataSelectedItems.clear();
    document.querySelectorAll('.data-checkbox').forEach(cb => cb.checked = false);
    document.getElementById('data-select-all').checked = false;
    updateDataBulkActions();
}

// CRUD Operations for Types
function openCreateTypeModal() {
    currentEditId = null;
    document.getElementById('type-modal-title').textContent = 'Tambah Jenis Disabilitas';
    document.getElementById('type-form').reset();
    document.getElementById('type-modal').classList.remove('hidden');
}

function editTypeItem(id) {
    currentEditId = id;
    document.getElementById('type-modal-title').textContent = 'Edit Jenis Disabilitas';
    
    fetch(`{% url "references:disabilitas_type_detail" 0 %}`.replace('0', id))
        .then(response => response.json())
        .then(data => {
            populateTypeForm(data);
            document.getElementById('type-modal').classList.remove('hidden');
        })
        .catch(error => {
            console.error('Error loading item:', error);
            showToast('Terjadi kesalahan saat memuat data', 'error');
        });
}

function deleteTypeItem(id) {
    currentDeleteId = id;
    currentDeleteType = 'type';
    document.getElementById('delete-modal').classList.remove('hidden');
}

function populateTypeForm(data) {
    Object.keys(data).forEach(key => {
        const field = document.querySelector('#type-form [name="' + key + '"]');
        if (field) {
            if (field.type === 'checkbox') {
                field.checked = data[key];
            } else {
                field.value = data[key] || '';
            }
        }
    });
}

function saveTypeData() {
    const formData = new FormData(document.getElementById('type-form'));
    const data = {};
    
    for (let [key, value] of formData.entries()) {
        data[key] = value;
    }
    
    // Handle checkboxes
    document.querySelectorAll('#type-form input[type="checkbox"]').forEach(checkbox => {
        if (!data.hasOwnProperty(checkbox.name)) {
            data[checkbox.name] = false;
        } else {
            data[checkbox.name] = true;
        }
    });
    
    const url = currentEditId 
        ? `{% url "references:disabilitas_type_detail" 0 %}`.replace('0', currentEditId)
        : `{% url "references:disabilitas_type_create" %}`;
    
    const method = currentEditId ? 'PUT' : 'POST';
    
    fetch(url, {
        method: method,
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            closeTypeModal();
            loadTypeData();
            loadDropdownData(); // Refresh dropdown
            showToast(data.message, 'success');
        } else {
            showToast('Terjadi kesalahan saat menyimpan data', 'error');
        }
    })
    .catch(error => {
        console.error('Error saving data:', error);
        showToast('Terjadi kesalahan sistem', 'error');
    });
}

// CRUD Operations for Data
function openCreateModal() {
    currentEditId = null;
    document.getElementById('data-modal-title').textContent = 'Tambah Data Disabilitas';
    document.getElementById('data-form').reset();
    document.getElementById('data-modal').classList.remove('hidden');
}

function editDataItem(id) {
    currentEditId = id;
    document.getElementById('data-modal-title').textContent = 'Edit Data Disabilitas';
    
    fetch(`{% url "references:disabilitas_data_detail" 0 %}`.replace('0', id))
        .then(response => response.json())
        .then(data => {
            populateDataForm(data);
            document.getElementById('data-modal').classList.remove('hidden');
        })
        .catch(error => {
            console.error('Error loading item:', error);
            showToast('Terjadi kesalahan saat memuat data', 'error');
        });
}

function deleteDataItem(id) {
    currentDeleteId = id;
    currentDeleteType = 'data';
    document.getElementById('delete-modal').classList.remove('hidden');
}

function populateDataForm(data) {
    Object.keys(data).forEach(key => {
        const field = document.querySelector('#data-form [name="' + key + '"]');
        if (field) {
            if (field.type === 'checkbox') {
                field.checked = data[key];
            } else if (key === 'penduduk_id') {
                document.querySelector('#data-form [name="penduduk"]').value = data[key] || '';
            } else if (key === 'disability_type_id') {
                document.querySelector('#data-form [name="disability_type"]').value = data[key] || '';
            } else {
                field.value = data[key] || '';
            }
        }
    });
}

function saveData() {
    const formData = new FormData(document.getElementById('data-form'));
    const data = {};
    
    for (let [key, value] of formData.entries()) {
        data[key] = value;
    }
    
    // Handle checkboxes
    document.querySelectorAll('#data-form input[type="checkbox"]').forEach(checkbox => {
        if (!data.hasOwnProperty(checkbox.name)) {
            data[checkbox.name] = false;
        } else {
            data[checkbox.name] = true;
        }
    });
    
    const url = currentEditId 
        ? `{% url "references:disabilitas_data_detail" 0 %}`.replace('0', currentEditId)
        : `{% url "references:disabilitas_data_create" %}`;
    
    const method = currentEditId ? 'PUT' : 'POST';
    
    fetch(url, {
        method: method,
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            closeDataModal();
            loadDisabilitasData();
            showToast(data.message, 'success');
        } else {
            showToast('Terjadi kesalahan saat menyimpan data', 'error');
        }
    })
    .catch(error => {
        console.error('Error saving data:', error);
        showToast('Terjadi kesalahan sistem', 'error');
    });
}

// Delete confirmation
function confirmDelete() {
    if (!currentDeleteId || !currentDeleteType) return;
    
    let url;
    if (currentDeleteType === 'type') {
        url = `{% url "references:disabilitas_type_detail" 0 %}`.replace('0', currentDeleteId);
    } else {
        url = `{% url "references:disabilitas_data_detail" 0 %}`.replace('0', currentDeleteId);
    }
    
    fetch(url, {
        method: 'DELETE',
        headers: {
            'X-CSRFToken': getCookie('csrftoken')
        }
    })
    .then(response => response.json())
    .then(data => {
        closeDeleteModal();
        if (data.success) {
            if (currentDeleteType === 'type') {
                loadTypeData();
                loadDropdownData(); // Refresh dropdown
            } else {
                loadDisabilitasData();
            }
            showToast(data.message, 'success');
        } else {
            showToast(data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Error deleting item:', error);
        showToast('Terjadi kesalahan sistem', 'error');
    });
}

// Bulk delete functions
function bulkDeleteType() {
    if (typeSelectedItems.size === 0) return;
    
    if (confirm(`Apakah Anda yakin ingin menghapus ${typeSelectedItems.size} item?`)) {
        const promises = Array.from(typeSelectedItems).map(id => 
            fetch(`{% url "references:disabilitas_type_detail" 0 %}`.replace('0', id), {
                method: 'DELETE',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                }
            })
        );
        
        Promise.all(promises)
            .then(() => {
                clearTypeSelection();
                loadTypeData();
                loadDropdownData();
                showToast('Data berhasil dihapus', 'success');
            })
            .catch(error => {
                console.error('Error in bulk delete:', error);
                showToast('Terjadi kesalahan saat menghapus data', 'error');
            });
    }
}

function bulkDeleteData() {
    if (dataSelectedItems.size === 0) return;
    
    if (confirm(`Apakah Anda yakin ingin menghapus ${dataSelectedItems.size} item?`)) {
        const promises = Array.from(dataSelectedItems).map(id => 
            fetch(`{% url "references:disabilitas_data_detail" 0 %}`.replace('0', id), {
                method: 'DELETE',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                }
            })
        );
        
        Promise.all(promises)
            .then(() => {
                clearDataSelection();
                loadDisabilitasData();
                showToast('Data berhasil dihapus', 'success');
            })
            .catch(error => {
                console.error('Error in bulk delete:', error);
                showToast('Terjadi kesalahan saat menghapus data', 'error');
            });
    }
}

// Export/Import Functions
function exportData() {
    window.location.href = `{% url "references:export_data" "disabilitas" %}`;
    showToast('Export dimulai, file akan diunduh segera', 'success');
}

function importData() {
    document.getElementById('import-modal').classList.remove('hidden');
}

function handleImport() {
    const formData = new FormData(document.getElementById('import-form'));
    
    fetch(`{% url "references:import_data" "disabilitas" %}`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        closeImportModal();
        if (data.success) {
            if (currentTab === 'type') {
                loadTypeData();
            } else {
                loadDisabilitasData();
            }
            showToast(data.message, 'success');
        } else {
            showToast(data.message || 'Terjadi kesalahan saat import', 'error');
        }
    })
    .catch(error => {
        console.error('Error importing data:', error);
        showToast('Terjadi kesalahan sistem', 'error');
    });
}

function downloadTemplate() {
    window.location.href = `{% url "references:export_data" "disabilitas" %}?template=true`;
}

// Utility Functions
function closeTypeModal() {
    document.getElementById('type-modal').classList.add('hidden');
    document.getElementById('type-form').reset();
    currentEditId = null;
}

function closeDataModal() {
    document.getElementById('data-modal').classList.add('hidden');
    document.getElementById('data-form').reset();
    currentEditId = null;
}

function closeDeleteModal() {
    document.getElementById('delete-modal').classList.add('hidden');
    currentDeleteId = null;
    currentDeleteType = null;
}

function closeImportModal() {
    document.getElementById('import-modal').classList.add('hidden');
    document.getElementById('import-form').reset();
}

// Loading and empty states
function showTypeLoading() {
    document.getElementById('type-loading').classList.remove('hidden');
    document.getElementById('type-desktop-view').classList.add('hidden');
    document.getElementById('type-mobile-view').classList.add('hidden');
}

function hideTypeLoading() {
    document.getElementById('type-loading').classList.add('hidden');
    document.getElementById('type-desktop-view').classList.remove('hidden', 'sm:block');
    document.getElementById('type-desktop-view').classList.add('hidden', 'sm:block');
    document.getElementById('type-mobile-view').classList.remove('hidden', 'block');
    document.getElementById('type-mobile-view').classList.add('block', 'sm:hidden');
}

function showTypeEmptyState() {
    document.getElementById('type-empty-state').classList.remove('hidden');
    document.getElementById('type-desktop-view').classList.add('hidden');
    document.getElementById('type-mobile-view').classList.add('hidden');
}

function hideTypeEmptyState() {
    document.getElementById('type-empty-state').classList.add('hidden');
}

function showDataLoading() {
    document.getElementById('data-loading').classList.remove('hidden');
    document.getElementById('data-desktop-view').classList.add('hidden');
    document.getElementById('data-mobile-view').classList.add('hidden');
}

function hideDataLoading() {
    document.getElementById('data-loading').classList.add('hidden');
    document.getElementById('data-desktop-view').classList.remove('hidden', 'sm:block');
    document.getElementById('data-desktop-view').classList.add('hidden', 'sm:block');
    document.getElementById('data-mobile-view').classList.remove('hidden', 'block');
    document.getElementById('data-mobile-view').classList.add('block', 'sm:hidden');
}

function showDataEmptyState() {
    document.getElementById('data-empty-state').classList.remove('hidden');
    document.getElementById('data-desktop-view').classList.add('hidden');
    document.getElementById('data-mobile-view').classList.add('hidden');
}

function hideDataEmptyState() {
    document.getElementById('data-empty-state').classList.add('hidden');
}

// Search functions
function clearTypeSearch() {
    document.getElementById('type-search').value = '';
    loadTypeData();
}

function clearDataSearch() {
    document.getElementById('data-search').value = '';
    document.getElementById('type-filter').value = '';
    currentDataPage = 1;
    loadDisabilitasData();
}

function refreshTypeData() {
    loadTypeData();
    showToast('Data berhasil dimuat ulang', 'success');
}

function refreshDataData() {
    loadDisabilitasData();
    showToast('Data berhasil dimuat ulang', 'success');
}

// Pagination for data
function previousDataPage() {
    if (currentDataPage > 1) {
        currentDataPage--;
        loadDisabilitasData();
    }
}

function nextDataPage() {
    currentDataPage++;
    loadDisabilitasData();
}

function updateDataPagination(pagination) {
    const info = document.getElementById('data-pagination-info');
    const totalInfo = document.getElementById('data-total-info');
    const prevBtn = document.getElementById('data-prev-btn');
    const nextBtn = document.getElementById('data-next-btn');
    const pageNumbers = document.getElementById('data-page-numbers');
    
    totalDataItems = pagination.total_items || 0;
    const totalPages = Math.ceil(totalDataItems / itemsPerPage);
    
    if (pagination.total_items) {
        const start = ((pagination.current_page - 1) * itemsPerPage) + 1;
        const end = Math.min(pagination.current_page * itemsPerPage, pagination.total_items);
        info.textContent = `Menampilkan ${start}-${end} dari ${pagination.total_items} data`;
        totalInfo.textContent = `Total Data: ${pagination.total_items} (Tahun 2025)`;
    } else {
        info.textContent = 'Menampilkan 0 dari 0 data';
        totalInfo.textContent = 'Total Data: 0 (Tahun 2025)';
    }
    
    prevBtn.disabled = !pagination.has_previous;
    nextBtn.disabled = !pagination.has_next;
    
    // Generate page numbers
    pageNumbers.innerHTML = '';
    
    if (totalPages > 1) {
        const maxVisiblePages = 5;
        let startPage = Math.max(1, currentDataPage - Math.floor(maxVisiblePages / 2));
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
        
        if (endPage - startPage + 1 < maxVisiblePages) {
            startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }
        
        for (let i = startPage; i <= endPage; i++) {
            const pageBtn = document.createElement('button');
            pageBtn.textContent = i;
            pageBtn.className = `px-3 py-2 text-sm border rounded-md ${
                i === currentDataPage 
                    ? 'bg-primary-600 text-white border-primary-600' 
                    : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'
            }`;
            pageBtn.onclick = () => goToDataPage(i);
            pageNumbers.appendChild(pageBtn);
        }
    }
}

function goToDataPage(page) {
    currentDataPage = page;
    loadDisabilitasData();
}

function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function showToast(message, type) {
    const toast = document.createElement('div');
    toast.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-md shadow-lg ${
        type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
    }`;
    toast.textContent = message;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

// Set up delete confirmation
document.getElementById('confirm-delete-btn').addEventListener('click', confirmDelete);
</script>
{% endblock %}
