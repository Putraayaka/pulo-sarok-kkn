{% extends 'admin/base.html' %}

{% block title %}Dashboard Organisasi{% endblock %}

{% block page_title %}Dashboard Organisasi{% endblock %}

{% block content %}
<div class="p-4 sm:p-6">
    <!-- Header Section -->
    <div class="mb-6">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-900">Dashboard Organisasi</h1>
                <p class="mt-1 text-sm text-gray-600">Kelola data organisasi desa Pulosarok</p>
            </div>
            <div class="mt-4 sm:mt-0">
                <span class="text-sm text-gray-500">Terakhir diperbarui: </span>
                <span class="text-sm font-medium text-gray-900" id="last-updated"></span>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
        <!-- Perangkat Desa -->
        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-user-tie text-2xl text-blue-600"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-gray-500 truncate">Perangkat Desa</dt>
                            <dd class="text-lg font-medium text-gray-900">{{ perangkat_count }}</dd>
                            <dd class="text-xs text-green-600">{{ active_perangkat }} aktif</dd>
                        </dl>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-5 py-3">
                <div class="text-sm">
                    <a href="{% url 'organization:perangkat_list' %}" class="font-medium text-blue-700 hover:text-blue-900">
                        Lihat semua
                    </a>
                </div>
            </div>
        </div>

        <!-- Lembaga Adat -->
        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-landmark text-2xl text-purple-600"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-gray-500 truncate">Lembaga Adat</dt>
                            <dd class="text-lg font-medium text-gray-900">{{ lembaga_adat_count }}</dd>
                            <dd class="text-xs text-green-600">{{ active_lembaga }} aktif</dd>
                        </dl>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-5 py-3">
                <div class="text-sm">
                    <a href="{% url 'organization:lembaga_adat_list' %}" class="font-medium text-purple-700 hover:text-purple-900">
                        Lihat semua
                    </a>
                </div>
            </div>
        </div>

        <!-- Penggerak PKK -->
        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-users text-2xl text-pink-600"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-gray-500 truncate">Penggerak PKK</dt>
                            <dd class="text-lg font-medium text-gray-900">{{ penggerak_pkk_count }}</dd>
                            <dd class="text-xs text-green-600">{{ active_pkk }} aktif</dd>
                        </dl>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-5 py-3">
                <div class="text-sm">
                    <a href="{% url 'organization:penggerak_pkk_list' %}" class="font-medium text-pink-700 hover:text-pink-900">
                        Lihat semua
                    </a>
                </div>
            </div>
        </div>

        <!-- Kepemudaan -->
        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-graduation-cap text-2xl text-green-600"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-gray-500 truncate">Kepemudaan</dt>
                            <dd class="text-lg font-medium text-gray-900">{{ kepemudaan_count }}</dd>
                            <dd class="text-xs text-green-600">{{ active_kepemudaan }} aktif</dd>
                        </dl>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-5 py-3">
                <div class="text-sm">
                    <a href="{% url 'organization:kepemudaan_list' %}" class="font-medium text-green-700 hover:text-green-900">
                        Lihat semua
                    </a>
                </div>
            </div>
        </div>

        <!-- Karang Taruna -->
        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-handshake text-2xl text-orange-600"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-gray-500 truncate">Karang Taruna</dt>
                            <dd class="text-lg font-medium text-gray-900">{{ karang_taruna_count }}</dd>
                            <dd class="text-xs text-green-600">{{ active_karang_taruna }} aktif</dd>
                        </dl>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-5 py-3">
                <div class="text-sm">
                    <a href="{% url 'organization:karang_taruna_list' %}" class="font-medium text-orange-700 hover:text-orange-900">
                        Lihat semua
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- Aksi Cepat -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">
                    <i class="fas fa-bolt mr-2 text-yellow-500"></i>Aksi Cepat
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <a href="{% url 'organization:perangkat_add' %}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        <i class="fas fa-plus mr-2"></i>Tambah Perangkat
                    </a>
                    <a href="{% url 'organization:lembaga_adat_add' %}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
                        <i class="fas fa-plus mr-2"></i>Tambah Lembaga
                    </a>
                    <a href="{% url 'organization:penggerak_pkk_add' %}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500">
                        <i class="fas fa-plus mr-2"></i>Tambah PKK
                    </a>
                    <a href="{% url 'organization:kepemudaan_add' %}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        <i class="fas fa-plus mr-2"></i>Tambah Kepemudaan
                    </a>
                </div>
            </div>
        </div>

        <!-- Informasi Sistem -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">
                    <i class="fas fa-info-circle mr-2 text-blue-500"></i>Informasi Sistem
                </h3>
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600">Total Organisasi:</span>
                        <span class="text-sm font-medium text-gray-900" id="total-organizations">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600">Total Anggota Aktif:</span>
                        <span class="text-sm font-medium text-gray-900" id="total-active-members">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600">Organisasi Terbaru:</span>
                        <span class="text-sm font-medium text-gray-900" id="latest-organization">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activities -->
    <div class="bg-white shadow rounded-lg">
        <div class="px-4 py-5 sm:p-6">
            <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">
                <i class="fas fa-clock mr-2 text-gray-500"></i>Aktivitas Terbaru
            </h3>
            <div class="flow-root">
                <ul class="-mb-8" id="recent-activities">
                    <li class="text-center py-8 text-gray-500">
                        <i class="fas fa-spinner fa-spin mr-2"></i>Memuat aktivitas...
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
// Update timestamp
document.getElementById('last-updated').textContent = new Date().toLocaleString('id-ID');

// Calculate totals
function updateTotals() {
    const perangkat = {{ perangkat_count }};
    const lembaga = {{ lembaga_adat_count }};
    const pkk = {{ penggerak_pkk_count }};
    const kepemudaan = {{ kepemudaan_count }};
    const karangTaruna = {{ karang_taruna_count }};
    
    const totalOrganizations = perangkat + lembaga + pkk + kepemudaan + karangTaruna;
    const totalActiveMembers = {{ active_perangkat }} + {{ active_lembaga }} + {{ active_pkk }} + {{ active_kepemudaan }} + {{ active_karang_taruna }};
    
    document.getElementById('total-organizations').textContent = totalOrganizations;
    document.getElementById('total-active-members').textContent = totalActiveMembers;
}

// Load recent activities (mock data for now)
function loadRecentActivities() {
    const activities = [
        {
            type: 'perangkat',
            action: 'Perangkat desa baru ditambahkan',
            time: '2 jam yang lalu',
            icon: 'fa-user-plus',
            color: 'text-blue-600'
        },
        {
            type: 'lembaga',
            action: 'Lembaga adat diperbarui',
            time: '5 jam yang lalu',
            icon: 'fa-edit',
            color: 'text-purple-600'
        },
        {
            type: 'pkk',
            action: 'Anggota PKK baru bergabung',
            time: '1 hari yang lalu',
            icon: 'fa-user-plus',
            color: 'text-pink-600'
        }
    ];
    
    const container = document.getElementById('recent-activities');
    container.innerHTML = '';
    
    activities.forEach((activity, index) => {
        const isLast = index === activities.length - 1;
        const li = document.createElement('li');
        li.className = isLast ? '' : 'pb-8';
        
        li.innerHTML = `
            <div class="relative">
                ${!isLast ? '<span class="absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200" aria-hidden="true"></span>' : ''}
                <div class="relative flex space-x-3">
                    <div>
                        <span class="h-8 w-8 rounded-full bg-gray-100 flex items-center justify-center ring-8 ring-white">
                            <i class="fas ${activity.icon} ${activity.color}"></i>
                        </span>
                    </div>
                    <div class="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                        <div>
                            <p class="text-sm text-gray-900">${activity.action}</p>
                        </div>
                        <div class="text-right text-sm whitespace-nowrap text-gray-500">
                            <time>${activity.time}</time>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        container.appendChild(li);
    });
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    updateTotals();
    loadRecentActivities();
});
</script>
{% endblock %}