{% extends 'admin/base.html' %}
{% load static %}
{% load form_tags %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<style>
  /* Responsif CSS untuk form kepemudaan */
  * {
    box-sizing: border-box;
  }
  
  .form-container {
    width: 100%;
    padding: 0;
  }
  
  .form-field {
    margin-bottom: 1rem;
  }
  
  .form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
  }
  
  .form-input {
    width: 100% !important;
    padding: 0.75rem !important;
    border-radius: 0.375rem !important;
    border: 1px solid #e2e8f0 !important;
    outline: none !important;
    transition: border-color 0.2s ease-in-out !important;
    background-color: #ffffff !important;
    color: #1f2937 !important;
    font-size: 0.875rem !important;
    line-height: 1.25rem !important;
  }
  
  .form-input:focus {
    border-color: #3b82f6 !important;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
  }
  
  .form-input:disabled {
    background-color: #f3f4f6 !important;
    cursor: not-allowed !important;
  }
  
  select.form-input {
    appearance: none !important;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e") !important;
    background-position: right 0.5rem center !important;
    background-repeat: no-repeat !important;
    background-size: 1.5em 1.5em !important;
    padding-right: 2.5rem !important;
  }
  
  textarea.form-input {
    min-height: 6rem !important;
    resize: vertical !important;
  }
  
  .form-error {
    color: #ef4444;
    font-size: 0.875rem;
    margin-top: 0.25rem;
  }
  
  .form-button {
    width: 100%;
    padding: 0.75rem !important;
    border-radius: 0.375rem;
    font-weight: 500;
    text-align: center;
    transition: all 0.2s ease-in-out;
  }
  
  .form-button-primary {
    background-color: #3b82f6;
    color: white;
  }
  
  .form-button-secondary {
    background-color: white;
    color: #4b5563;
    border: 1px solid #d1d5db;
  }
  
  .form-button-primary:hover {
    background-color: #2563eb;
  }
  
  .form-button-secondary:hover {
    background-color: #f9fafb;
  }
  
  /* Media queries untuk responsif mobile */
  @media (max-width: 640px) {
    .container-fluid {
      padding: 1rem !important;
    }
    
    .p-6 {
      padding: 1rem !important;
    }
    
    .space-y-6 > * + * {
      margin-top: 1rem !important;
    }
    
    .gap-6 {
      gap: 0.75rem !important;
    }
    
    h1 {
      font-size: 1.5rem !important;
    }
    
    .form-button {
      margin-bottom: 0.5rem;
    }
  }
</style>
<div class="container-fluid px-4 py-6">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
        <div>
            <h1 class="text-2xl font-bold text-gray-900 mb-2">{{ title }}</h1>
            <nav class="text-sm text-gray-500">
                <a href="{% url 'custom_admin:dashboard' %}" class="hover:text-blue-600">Dashboard</a>
                <span class="mx-2">/</span>
                <a href="{% url 'organization:kepemudaan_list' %}" class="hover:text-blue-600">Kepemudaan</a>
                <span class="mx-2">/</span>
                <span class="text-gray-700">{{ title }}</span>
            </nav>
        </div>
        <a href="{% url 'organization:kepemudaan_list' %}" class="inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
            <i class="fas fa-arrow-left mr-2"></i>
            Kembali
        </a>
    </div>

    <!-- Form Card -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 form-container">
        <div class="p-6">
            <form method="post" enctype="multipart/form-data" class="space-y-6" id="kepemudaanForm">
                {% csrf_token %}
                
                <!-- Display form errors -->
                {% if form.non_field_errors %}
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="flex">
                            <i class="fas fa-exclamation-circle text-red-400 mt-0.5 mr-3"></i>
                            <div>
                                <h3 class="text-sm font-medium text-red-800">Terjadi kesalahan:</h3>
                                <div class="mt-2 text-sm text-red-700">
                                    {{ form.non_field_errors }}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6" style="width: 100%;">
                    <!-- Nama Organisasi -->
                    <div class="md:col-span-2 form-field">
                        <label for="{{ form.nama_organisasi.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2 form-label">
                            Nama Organisasi <span class="text-red-500">*</span>
                        </label>
                        {{ form.nama_organisasi|add_class:"form-input"|attr:"required:required" }}
                        {% if form.nama_organisasi.errors %}
                            <p class="mt-1 text-sm text-red-600 form-error">{{ form.nama_organisasi.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Jenis Organisasi -->
                    <div class="form-field">
                        <label for="{{ form.jenis_organisasi.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2 form-label">
                            Jenis Organisasi <span class="text-red-500">*</span>
                        </label>
                        {{ form.jenis_organisasi|add_class:"form-input" }}
                        {% if form.jenis_organisasi.errors %}
                            <p class="mt-1 text-sm text-red-600 form-error">{{ form.jenis_organisasi.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Status -->
                    <div class="form-field">
                        <label for="{{ form.status.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2 form-label">
                            Status <span class="text-red-500">*</span>
                        </label>
                        {{ form.status|add_class:"form-input" }}
                        {% if form.status.errors %}
                            <p class="mt-1 text-sm text-red-600 form-error">{{ form.status.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Ketua -->
                    <div class="form-field">
                        <label for="{{ form.ketua.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2 form-label">
                            Ketua <span class="text-red-500">*</span>
                        </label>
                        {{ form.ketua|add_class:"form-input" }}
                        {% if form.ketua.errors %}
                            <p class="mt-1 text-sm text-red-600 form-error">{{ form.ketua.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Wakil Ketua -->
                    <div class="form-field">
                        <label for="{{ form.wakil_ketua.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2 form-label">
                            Wakil Ketua
                        </label>
                        {{ form.wakil_ketua|add_class:"form-input" }}
                        {% if form.wakil_ketua.errors %}
                            <p class="mt-1 text-sm text-red-600 form-error">{{ form.wakil_ketua.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Sekretaris -->
                    <div class="form-field">
                        <label for="{{ form.sekretaris.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2 form-label">
                            Sekretaris
                        </label>
                        {{ form.sekretaris|add_class:"form-input" }}
                        {% if form.sekretaris.errors %}
                            <p class="mt-1 text-sm text-red-600 form-error">{{ form.sekretaris.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Bendahara -->
                    <div class="form-field">
                        <label for="{{ form.bendahara.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2 form-label">
                            Bendahara
                        </label>
                        {{ form.bendahara|add_class:"form-input" }}
                        {% if form.bendahara.errors %}
                            <p class="mt-1 text-sm text-red-600 form-error">{{ form.bendahara.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Jumlah Anggota -->
                    <div class="form-field">
                        <label for="{{ form.jumlah_anggota.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2 form-label">
                            Jumlah Anggota
                        </label>
                        {{ form.jumlah_anggota|add_class:"form-input" }}
                        {% if form.jumlah_anggota.errors %}
                            <p class="mt-1 text-sm text-red-600 form-error">{{ form.jumlah_anggota.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Tanggal Berdiri -->
                    <div class="form-field">
                        <label for="{{ form.tanggal_berdiri.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2 form-label">
                            Tanggal Berdiri <span class="text-red-500">*</span>
                        </label>
                        {{ form.tanggal_berdiri|add_class:"form-input"|attr:"required:required" }}
                        {% if form.tanggal_berdiri.errors %}
                            <p class="mt-1 text-sm text-red-600 form-error">{{ form.tanggal_berdiri.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- SK Kepengurusan -->
                    <div class="form-field">
                        <label for="{{ form.sk_kepengurusan.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2 form-label">
                            SK Kepengurusan
                        </label>
                        {{ form.sk_kepengurusan|add_class:"form-input" }}
                        {% if form.sk_kepengurusan.errors %}
                            <p class="mt-1 text-sm text-red-600 form-error">{{ form.sk_kepengurusan.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Lokasi Sekretariat -->
                    <div class="form-field">
                        <label for="{{ form.lokasi_sekretariat.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2 form-label">
                            Lokasi Sekretariat
                        </label>
                        {{ form.lokasi_sekretariat|add_class:"form-input" }}
                        {% if form.lokasi_sekretariat.errors %}
                            <p class="mt-1 text-sm text-red-600 form-error">{{ form.lokasi_sekretariat.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Kontak -->
                    <div class="form-field">
                        <label for="{{ form.kontak.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2 form-label">
                            Kontak
                        </label>
                        {{ form.kontak|add_class:"form-input" }}
                        {% if form.kontak.errors %}
                            <p class="mt-1 text-sm text-red-600 form-error">{{ form.kontak.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Email -->
                    <div class="form-field">
                        <label for="{{ form.email.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2 form-label">
                            Email
                        </label>
                        {{ form.email|add_class:"form-input" }}
                        {% if form.email.errors %}
                            <p class="mt-1 text-sm text-red-600 form-error">{{ form.email.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Foto Profil -->
                    <div class="md:col-span-2 form-field">
                        <label for="{{ form.foto_profil.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2 form-label">
                            Foto Profil
                        </label>
                        
                        <!-- Current photo preview -->
                        {% if form.instance.foto_profil %}
                            <div class="mb-3">
                                <p class="text-sm text-gray-600 mb-2">Foto saat ini:</p>
                                <img src="{{ form.instance.foto_profil.url }}" alt="Foto Profil" class="w-24 h-24 object-cover rounded-lg border border-gray-300">
                            </div>
                        {% endif %}
                        
                        {{ form.foto_profil|add_class:"form-input" }}
                        {% if form.foto_profil.errors %}
                            <p class="mt-1 text-sm text-red-600 form-error">{{ form.foto_profil.errors.0 }}</p>
                        {% endif %}
                        <p class="mt-1 text-sm text-gray-500">Format yang didukung: JPG, PNG, GIF. Maksimal 2MB.</p>
                        
                        <!-- Preview for new upload -->
                        <div id="foto-preview" class="mt-3 hidden">
                            <p class="text-sm text-gray-600 mb-2">Preview foto baru:</p>
                            <img id="foto-preview-img" src="" alt="Preview" class="w-24 h-24 object-cover rounded-lg border border-gray-300">
                        </div>
                    </div>

                    <!-- Deskripsi -->
                    <div class="md:col-span-2 form-field">
                        <label for="{{ form.deskripsi.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2 form-label">
                            Deskripsi
                        </label>
                        {{ form.deskripsi|add_class:"form-input" }}
                        {% if form.deskripsi.errors %}
                            <p class="mt-1 text-sm text-red-600 form-error">{{ form.deskripsi.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Foto Kegiatan -->
                    <div class="md:col-span-2 form-field">
                        <label for="{{ form.foto_kegiatan.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2 form-label">
                            Foto Kegiatan
                        </label>
                        
                        <!-- Current photo preview -->
                        {% if form.instance.foto_kegiatan %}
                            <div class="mb-3">
                                <p class="text-sm text-gray-600 mb-2">Foto kegiatan saat ini:</p>
                                <img src="{{ form.instance.foto_kegiatan.url }}" alt="Foto Kegiatan" class="h-40 w-auto object-cover rounded-lg border border-gray-300">
                            </div>
                        {% endif %}
                        
                        {{ form.foto_kegiatan|add_class:"form-input" }}
                        {% if form.foto_kegiatan.errors %}
                            <p class="mt-1 text-sm text-red-600 form-error">{{ form.foto_kegiatan.errors.0 }}</p>
                        {% endif %}
                        <p class="mt-1 text-sm text-gray-500">Format yang didukung: JPG, PNG, GIF. Maksimal 2MB.</p>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="flex flex-col sm:flex-row sm:justify-end gap-3 mt-6">
                    <a href="{% url 'organization:kepemudaan_list' %}" class="form-button form-button-secondary">
                        Batal
                    </a>
                    <button type="submit" class="form-button form-button-primary" id="submitButton">
                        {{ submit_text|default:"Simpan" }}
                    </button>
                </div>
                
                <script>
                    document.getElementById('kepemudaanForm').addEventListener('submit', function(e) {
                        // Pastikan nama_organisasi diisi
                        var namaOrganisasi = document.querySelector('input[name="nama_organisasi"]');
                        if (!namaOrganisasi.value.trim()) {
                            namaOrganisasi.classList.add('border-red-500');
                            alert('Nama Organisasi harus diisi!');
                            e.preventDefault();
                            return false;
                        }
                        
                        // Pastikan jenis_organisasi dipilih
                        var jenisOrganisasi = document.querySelector('select[name="jenis_organisasi"]');
                        if (!jenisOrganisasi.value) {
                            jenisOrganisasi.classList.add('border-red-500');
                            alert('Jenis Organisasi harus dipilih!');
                            e.preventDefault();
                            return false;
                        }
                        
                        // Pastikan ketua dipilih
                        var ketua = document.querySelector('select[name="ketua"]');
                        if (!ketua.value) {
                            ketua.classList.add('border-red-500');
                            alert('Ketua harus dipilih!');
                            e.preventDefault();
                            return false;
                        }
                        
                        // Pastikan status dipilih
                        var status = document.querySelector('select[name="status"]');
                        if (!status.value) {
                            status.classList.add('border-red-500');
                            alert('Status harus dipilih!');
                            e.preventDefault();
                            return false;
                        }
                        
                        // Pastikan tanggal_berdiri diisi
                        var tanggalBerdiri = document.querySelector('input[name="tanggal_berdiri"]');
                        if (!tanggalBerdiri.value) {
                            tanggalBerdiri.classList.add('border-red-500');
                            alert('Tanggal Berdiri harus diisi!');
                            e.preventDefault();
                            return false;
                        }
                        
                        return true;
                    });
                </script>
            </form>
        </div>
    </div>
</div>

<script>
    // Mobile responsive adjustments
    function adjustForMobile() {
        if (window.innerWidth < 640) {
            document.querySelectorAll('.form-button').forEach(btn => {
                btn.classList.add('mb-2');
            });
        } else {
            document.querySelectorAll('.form-button').forEach(btn => {
                btn.classList.remove('mb-2');
            });
        }
    }

    window.addEventListener('load', adjustForMobile);
    window.addEventListener('resize', adjustForMobile);

    // File input preview for foto_profil
    document.addEventListener('DOMContentLoaded', function() {
        const fileInput = document.getElementById('{{ form.foto_profil.id_for_label }}');
        const previewContainer = document.getElementById('foto-preview');
        const previewImage = document.getElementById('foto-preview-img');

        if (fileInput) {
            fileInput.addEventListener('change', function() {
                if (this.files && this.files[0]) {
                    const file = this.files[0];
                    
                    // Validate file size (max 2MB)
                    if (file.size > 2 * 1024 * 1024) {
                        alert('Ukuran file terlalu besar. Maksimal 2MB.');
                        this.value = '';
                        previewContainer.classList.add('hidden');
                        return;
                    }
                    
                    // Validate file type
                    const validTypes = ['image/jpeg', 'image/png', 'image/gif'];
                    if (!validTypes.includes(file.type)) {
                        alert('Format file tidak didukung. Gunakan JPG, PNG, atau GIF.');
                        this.value = '';
                        previewContainer.classList.add('hidden');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewImage.src = e.target.result;
                        previewContainer.classList.remove('hidden');
                    }
                    reader.readAsDataURL(file);
                } else {
                    previewContainer.classList.add('hidden');
                }
            });
        }
    });

    // Form validation
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        
        form.addEventListener('submit', function(event) {
            let isValid = true;
            const requiredFields = form.querySelectorAll('input[required], select[required], textarea[required]');
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    isValid = false;
                    field.classList.add('border-red-500');
                    
                    // Find the parent form-field div
                    const formField = field.closest('.form-field');
                    if (formField) {
                        // Add shake animation
                        formField.classList.add('animate-shake');
                        setTimeout(() => {
                            formField.classList.remove('animate-shake');
                        }, 500);
                        
                        // Scroll to the first invalid field
                        if (isValid === false) {
                            formField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }
                } else {
                    field.classList.remove('border-red-500');
                }
            });
            
            if (!isValid) {
                event.preventDefault();
                alert('Mohon lengkapi semua field yang wajib diisi.');
            }
        });
    });
</script>
{% endblock %}