{% extends 'admin/base.html' %}

{% block title %}Berita{% endblock %}

{% block page_title %}Berita{% endblock %}

{% block content %}
<div class="p-4 sm:p-6">
    <!-- Header Section -->
    <div class="bg-white rounded-lg shadow-sm border p-4 sm:p-6 mb-6">
        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4">
            <div>
                <h2 class="text-xl sm:text-2xl font-bold text-gray-900">Manajemen Berita</h2>
                <p class="text-gray-600 mt-1 text-sm sm:text-base">Kelola berita dan informasi desa</p>
            </div>
            <div class="flex flex-col sm:flex-row gap-2 sm:gap-3">
                <button id="add-news-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors duration-200 text-sm sm:text-base">
                    <i class="fas fa-plus mr-2"></i>
                    Tambah Berita
                </button>
                <button id="import-btn" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors duration-200 text-sm sm:text-base">
                    <i class="fas fa-upload mr-2"></i>
                    Import Data
                </button>
                <button id="bulk-actions-btn" class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 transition-colors duration-200 text-sm sm:text-base hidden" onclick="openBulkModal()">
                    <i class="fas fa-tasks mr-2"></i>
                    Aksi Massal
                </button>
            </div>
        </div>
    </div>
    
    <!-- Statistics Cards -->
    <div class="grid grid-cols-2 lg:grid-cols-6 gap-4 sm:gap-6 mb-6">
        <div class="bg-white rounded-lg shadow-sm border p-4 sm:p-6">
            <div class="flex items-center">
                <div class="p-2 sm:p-3 rounded-full bg-blue-100 text-blue-600">
                    <i class="fas fa-newspaper text-lg sm:text-2xl"></i>
                </div>
                <div class="ml-3 sm:ml-4">
                    <p class="text-xs sm:text-sm font-medium text-gray-600">Total Berita</p>
                    <p class="text-lg sm:text-2xl font-semibold text-gray-900" id="total-news">{{ stats.total_news|default:'-' }}</p>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-sm border p-4 sm:p-6">
            <div class="flex items-center">
                <div class="p-2 sm:p-3 rounded-full bg-green-100 text-green-600">
                    <i class="fas fa-check-circle text-lg sm:text-2xl"></i>
                </div>
                <div class="ml-3 sm:ml-4">
                    <p class="text-xs sm:text-sm font-medium text-gray-600">Dipublikasi</p>
                    <p class="text-lg sm:text-2xl font-semibold text-gray-900" id="published-news">{{ stats.published_news|default:'-' }}</p>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-sm border p-4 sm:p-6">
            <div class="flex items-center">
                <div class="p-2 sm:p-3 rounded-full bg-yellow-100 text-yellow-600">
                    <i class="fas fa-clock text-lg sm:text-2xl"></i>
                </div>
                <div class="ml-3 sm:ml-4">
                    <p class="text-xs sm:text-sm font-medium text-gray-600">Draft</p>
                    <p class="text-lg sm:text-2xl font-semibold text-gray-900" id="draft-news">{{ stats.draft_news|default:'-' }}</p>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-sm border p-4 sm:p-6">
            <div class="flex items-center">
                <div class="p-2 sm:p-3 rounded-full bg-orange-100 text-orange-600">
                    <i class="fas fa-calendar-alt text-lg sm:text-2xl"></i>
                </div>
                <div class="ml-3 sm:ml-4">
                    <p class="text-xs sm:text-sm font-medium text-gray-600">Terjadwal</p>
                    <p class="text-lg sm:text-2xl font-semibold text-gray-900" id="scheduled-news">{{ stats.scheduled_news|default:'-' }}</p>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-sm border p-4 sm:p-6">
            <div class="flex items-center">
                <div class="p-2 sm:p-3 rounded-full bg-purple-100 text-purple-600">
                    <i class="fas fa-eye text-lg sm:text-2xl"></i>
                </div>
                <div class="ml-3 sm:ml-4">
                    <p class="text-xs sm:text-sm font-medium text-gray-600">Total Views</p>
                    <p class="text-lg sm:text-2xl font-semibold text-gray-900" id="total-views">{{ stats.total_views|default:'-' }}</p>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-sm border p-4 sm:p-6">
            <div class="flex items-center">
                <div class="p-2 sm:p-3 rounded-full bg-red-100 text-red-600">
                    <i class="fas fa-heart text-lg sm:text-2xl"></i>
                </div>
                <div class="ml-3 sm:ml-4">
                    <p class="text-xs sm:text-sm font-medium text-gray-600">Total Likes</p>
                    <p class="text-lg sm:text-2xl font-semibold text-gray-900" id="total-likes">{{ stats.total_likes|default:'-' }}</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- News Management Tabs -->
    <div class="bg-white rounded-lg shadow-sm border">
        <div class="border-b border-gray-200">
            <nav class="-mb-px flex flex-wrap px-4 sm:px-6" aria-label="Tabs">
                <button class="news-tab border-blue-500 text-blue-600 whitespace-nowrap py-4 px-2 sm:px-4 border-b-2 font-medium text-sm" data-tab="list">
                    <i class="fas fa-list mr-1 sm:mr-2"></i>
                    <span class="hidden sm:inline">Daftar </span>Berita
                </button>
                <button class="news-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-2 sm:px-4 border-b-2 font-medium text-sm" data-tab="categories">
                    <i class="fas fa-tags mr-1 sm:mr-2"></i>
                    <span class="hidden sm:inline">Kategori </span>Berita
                </button>
                <button class="news-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-2 sm:px-4 border-b-2 font-medium text-sm" data-tab="gallery">
                    <i class="fas fa-images mr-1 sm:mr-2"></i>
                    <span class="hidden sm:inline">Galeri </span>Media
                </button>
                <button class="news-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-2 sm:px-4 border-b-2 font-medium text-sm" data-tab="analytics">
                    <i class="fas fa-chart-bar mr-1 sm:mr-2"></i>
                    <span class="hidden sm:inline">Analitik </span>Berita
                </button>
            </nav>
        </div>
        
        <!-- News List Tab -->
        <div id="list-tab" class="news-content p-4 sm:p-6">
            <!-- Search and Filter -->
            <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4 mb-6">
                <div class="flex flex-col sm:flex-row gap-3 flex-1">
                    <div class="relative flex-1 sm:max-w-xs">
                        <input type="text" id="search-news" placeholder="Cari berita..." 
                               class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                    </div>
                    
                    <select id="filter-category" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                        <option value="">Semua Kategori</option>
                        <option value="pengumuman">Pengumuman</option>
                        <option value="kegiatan">Kegiatan</option>
                        <option value="pembangunan">Pembangunan</option>
                        <option value="sosial">Sosial</option>
                        <option value="ekonomi">Ekonomi</option>
                        <option value="kesehatan">Kesehatan</option>
                    </select>
                    
                    <select id="filter-status" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                        <option value="">Semua Status</option>
                        <option value="published">Dipublikasi</option>
                        <option value="draft">Draft</option>
                        <option value="scheduled">Terjadwal</option>
                        <option value="archived">Diarsipkan</option>
                    </select>
                    
                    <input type="date" id="filter-date" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                </div>
                
                <div class="flex flex-col sm:flex-row gap-2">
                    <button id="export-excel-btn" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors duration-200 text-sm">
                        <i class="fas fa-file-excel mr-2"></i>
                        Excel
                    </button>
                    <button id="export-pdf-btn" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition-colors duration-200 text-sm">
                        <i class="fas fa-file-pdf mr-2"></i>
                        PDF
                    </button>
                </div>
            </div>
            
            <!-- News Table -->
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <input type="checkbox" id="select-all-news" class="rounded border-gray-300">
                            </th>
                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Judul</th>
                            <th class="hidden sm:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kategori</th>
                            <th class="hidden md:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Penulis</th>
                            <th class="hidden lg:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                            <th class="hidden lg:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Views</th>
                            <th class="hidden xl:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Likes</th>
                            <th class="hidden xl:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Komentar</th>
                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="news-table-body" class="bg-white divide-y divide-gray-200">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mt-6">
                <div class="text-sm text-gray-700">
                    Menampilkan <span id="showing-start">1</span> sampai <span id="showing-end">25</span> dari <span id="total-records">0</span> data
                </div>
                <div class="flex justify-center sm:justify-end">
                    <nav class="flex space-x-1" aria-label="Pagination">
                        <button id="prev-page" class="px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <div id="page-numbers" class="flex space-x-1">
                            <!-- Page numbers will be generated here -->
                        </div>
                        <button id="next-page" class="px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </nav>
                </div>
            </div>
        </div>
        
        <!-- Categories Tab -->
        <div id="categories-tab" class="news-content p-4 sm:p-6 hidden">
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Kategori Berita</h3>
                <button id="add-category-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors duration-200 text-sm">
                    <i class="fas fa-plus mr-2"></i>
                    Tambah Kategori
                </button>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6" id="categories-grid">
                <!-- Categories will be loaded here -->
            </div>
        </div>
        
        <!-- Gallery Tab -->
        <div id="gallery-tab" class="news-content p-4 sm:p-6 hidden">
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Galeri Media</h3>
                <div class="flex gap-2">
                    <select id="media-filter" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                        <option value="">Semua Media</option>
                        <option value="image">Gambar</option>
                        <option value="video">Video</option>
                        <option value="document">Dokumen</option>
                    </select>
                    <button id="upload-media-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors duration-200 text-sm">
                        <i class="fas fa-upload mr-2"></i>
                        Upload Media
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4" id="media-grid">
                <!-- Media files will be loaded here -->
            </div>
        </div>
        
        <!-- Analytics Tab -->
        <div id="analytics-tab" class="news-content p-4 sm:p-6 hidden">
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Analitik Berita</h3>
                <div class="flex gap-2">
                    <select id="analytics-period" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                        <option value="7days">7 Hari Terakhir</option>
                        <option value="30days">30 Hari Terakhir</option>
                        <option value="3months">3 Bulan Terakhir</option>
                        <option value="1year">1 Tahun Terakhir</option>
                    </select>
                    <button id="refresh-analytics-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors duration-200 text-sm">
                        <i class="fas fa-sync-alt mr-2"></i>
                        Refresh
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-gray-50 rounded-lg p-6">
                    <h4 class="text-lg font-semibold mb-4">Views per Hari</h4>
                    <div class="h-64 flex items-center justify-center text-gray-500">
                        <div class="text-center">
                            <i class="fas fa-chart-line text-4xl mb-4"></i>
                            <p>Grafik views akan ditampilkan di sini</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 rounded-lg p-6">
                    <h4 class="text-lg font-semibold mb-4">Kategori Terpopuler</h4>
                    <div class="h-64 flex items-center justify-center text-gray-500">
                        <div class="text-center">
                            <i class="fas fa-chart-pie text-4xl mb-4"></i>
                            <p>Grafik kategori akan ditampilkan di sini</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white border border-gray-200 rounded-lg p-6">
                <h4 class="text-lg font-semibold mb-4">Berita Terpopuler</h4>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Judul</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Views</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Shares</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                            </tr>
                        </thead>
                        <tbody id="popular-news-body" class="bg-white divide-y divide-gray-200">
                            <!-- Popular news data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>



<!-- Add Category Modal -->
<div id="category-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 sm:w-2/3 lg:w-1/2 shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-900">Tambah Kategori</h3>
                <button id="close-category-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="category-form">
                <div class="space-y-4">
                    <div>
                        <label for="nama_kategori" class="block text-sm font-medium text-gray-700 mb-1">Nama Kategori *</label>
                        <input type="text" id="nama_kategori" name="nama_kategori" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                    </div>
                    
                    <div>
                        <label for="slug_kategori" class="block text-sm font-medium text-gray-700 mb-1">Slug</label>
                        <input type="text" id="slug_kategori" name="slug_kategori" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                    </div>
                    
                    <div>
                        <label for="deskripsi_kategori" class="block text-sm font-medium text-gray-700 mb-1">Deskripsi</label>
                        <textarea id="deskripsi_kategori" name="deskripsi_kategori" rows="3" 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="warna_kategori" class="block text-sm font-medium text-gray-700 mb-1">Warna</label>
                            <input type="color" id="warna_kategori" name="warna_kategori" value="#3B82F6" 
                                   class="w-full h-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="icon_kategori" class="block text-sm font-medium text-gray-700 mb-1">Icon (Font Awesome)</label>
                            <input type="text" id="icon_kategori" name="icon_kategori" placeholder="fas fa-newspaper" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" id="cancel-category-btn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 text-sm">
                        Batal
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm">
                        <i class="fas fa-save mr-2"></i>
                        Simpan
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Upload Media Modal -->
<div id="media-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 sm:w-2/3 lg:w-1/2 shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-900">Upload Media</h3>
                <button id="close-media-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="media-form">
                <div class="space-y-4">
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center">
                        <div id="media-drop-zone">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                            <p class="text-lg text-gray-600 mb-2">Drag & drop files here</p>
                            <p class="text-sm text-gray-500 mb-4">atau</p>
                            <button type="button" id="select-files-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors duration-200">
                                Pilih File
                            </button>
                            <input type="file" id="media-files" name="media_files" multiple accept="image/*,video/*,.pdf,.doc,.docx" class="hidden">
                        </div>
                    </div>
                    
                    <div id="upload-progress" class="hidden">
                        <div class="bg-gray-200 rounded-full h-2">
                            <div id="progress-bar" class="bg-blue-600 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                        <p class="text-sm text-gray-600 mt-2">Uploading... <span id="progress-text">0%</span></p>
                    </div>
                    
                    <div id="file-list" class="space-y-2">
                        <!-- Selected files will be shown here -->
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" id="cancel-media-btn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 text-sm">
                        Batal
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm">
                        <i class="fas fa-upload mr-2"></i>
                        Upload
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="delete-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 sm:w-96 shadow-lg rounded-md bg-white">
        <div class="mt-3 text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
                <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mt-4">Konfirmasi Hapus</h3>
            <div class="mt-2 px-7 py-3">
                <p class="text-sm text-gray-500">
                    Apakah Anda yakin ingin menghapus data ini? Tindakan ini tidak dapat dibatalkan.
                </p>
            </div>
            <div class="flex justify-center gap-3 mt-4">
                <button id="cancel-delete" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 text-sm">
                    Batal
                </button>
                <button id="confirm-delete" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 text-sm">
                    Hapus
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<!-- Summernote CSS -->
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
{% endblock %}

{% block extra_js %}
<!-- jQuery (required for Summernote) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Summernote JS -->
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/lang/summernote-id-ID.min.js"></script>

<script>
    // Global variables
    let currentPage = 1;
    let totalPages = 1;
    let selectedItems = [];
    let editingId = null;
    let currentTab = 'list';
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        loadStatistics();
        loadTabData('list');
        initializeEventListeners();
        setupImageUpload();
        initializeSummernote();
        setupAdditionalImages();
    });
    
    // Initialize Summernote editor
    function initializeSummernote() {
        $('.summernote').summernote({
            height: 300,
            lang: 'id-ID',
            toolbar: [
                ['style', ['style']],
                ['font', ['bold', 'underline', 'clear']],
                ['fontname', ['fontname']],
                ['color', ['color']],
                ['para', ['ul', 'ol', 'paragraph']],
                ['table', ['table']],
                ['insert', ['link', 'picture', 'video']],
                ['view', ['fullscreen', 'codeview', 'help']]
            ],
            placeholder: 'Tulis konten berita di sini...',
            callbacks: {
                onImageUpload: function(files) {
                    // Handle image upload in editor
                    for (let i = 0; i < files.length; i++) {
                        uploadImageToEditor(files[i], this);
                    }
                }
            }
        });
    }
    
    // Upload image to Summernote editor
    function uploadImageToEditor(file, editor) {
        const data = new FormData();
        data.append('file', file);
        
        // Simulate upload - replace with actual upload endpoint
        const reader = new FileReader();
        reader.onload = function(e) {
            $(editor).summernote('insertImage', e.target.result);
        };
        reader.readAsDataURL(file);
    }
    
    // Setup additional images upload
    function setupAdditionalImages() {
        const additionalImagesInput = document.getElementById('additional_images');
        const previewContainer = document.getElementById('additional-images-preview');
        
        additionalImagesInput.addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            previewContainer.innerHTML = '';
            
            if (files.length > 0) {
                previewContainer.classList.remove('hidden');
                
                files.forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageDiv = document.createElement('div');
                        imageDiv.className = 'relative';
                        imageDiv.innerHTML = `
                            <img src="${e.target.result}" alt="Preview ${index + 1}" class="w-full h-24 object-cover rounded">
                            <button type="button" onclick="removeAdditionalImage(${index})" class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600">
                                <i class="fas fa-times"></i>
                            </button>
                            <div class="mt-1">
                                <input type="text" placeholder="Caption..." class="w-full text-xs p-1 border rounded" name="image_captions[]">
                            </div>
                        `;
                        previewContainer.appendChild(imageDiv);
                    };
                    reader.readAsDataURL(file);
                });
            } else {
                previewContainer.classList.add('hidden');
            }
        });
    }
    
    // Remove additional image
    function removeAdditionalImage(index) {
        const input = document.getElementById('additional_images');
        const dt = new DataTransfer();
        const files = Array.from(input.files);
        
        files.forEach((file, i) => {
            if (i !== index) {
                dt.items.add(file);
            }
        });
        
        input.files = dt.files;
        input.dispatchEvent(new Event('change'));
    }
    
    function initializeEventListeners() {
        // Tab switching
        document.querySelectorAll('.news-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const targetTab = this.dataset.tab;
                switchTab(targetTab);
            });
        });
        
        // Modal controls
        setupModalControls();
        
        // Form submissions
        setupFormHandlers();
        
        // Search and filters
        setupSearchAndFilters();
    }
    
    function switchTab(targetTab) {
        currentTab = targetTab;
        
        // Update tab appearance
        document.querySelectorAll('.news-tab').forEach(t => {
            t.classList.remove('border-blue-500', 'text-blue-600');
            t.classList.add('border-transparent', 'text-gray-500');
        });
        
        document.querySelector(`[data-tab="${targetTab}"]`).classList.remove('border-transparent', 'text-gray-500');
        document.querySelector(`[data-tab="${targetTab}"]`).classList.add('border-blue-500', 'text-blue-600');
        
        // Hide all content
        document.querySelectorAll('.news-content').forEach(content => {
            content.classList.add('hidden');
        });
        
        // Show target content
        document.getElementById(targetTab + '-tab').classList.remove('hidden');
        
        // Load data for the active tab
        loadTabData(targetTab);
    }
    
    function setupModalControls() {
        // News modal
        document.getElementById('add-news-btn').addEventListener('click', () => openNewsModal());
        
        // Category modal
        document.getElementById('add-category-btn').addEventListener('click', () => openCategoryModal());
        document.getElementById('close-category-modal').addEventListener('click', () => closeCategoryModal());
        document.getElementById('cancel-category-btn').addEventListener('click', () => closeCategoryModal());
        
        // Media modal
        document.getElementById('upload-media-btn').addEventListener('click', () => openMediaModal());
        document.getElementById('close-media-modal').addEventListener('click', () => closeMediaModal());
        document.getElementById('cancel-media-btn').addEventListener('click', () => closeMediaModal());
        
        // Delete modal
        document.getElementById('cancel-delete').addEventListener('click', () => closeDeleteModal());
        document.getElementById('confirm-delete').addEventListener('click', () => confirmDelete());
    }
    
    function setupFormHandlers() {
        document.getElementById('news-form').addEventListener('submit', handleNewsSubmit);
        document.getElementById('category-form').addEventListener('submit', handleCategorySubmit);
        document.getElementById('media-form').addEventListener('submit', handleMediaSubmit);
        
        // Auto-generate slug from title
        document.getElementById('judul_berita').addEventListener('input', function() {
            const title = this.value;
            const slug = title.toLowerCase()
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .trim('-');
            document.getElementById('slug_berita').value = slug;
        });
        
        // Auto-generate category slug
        document.getElementById('nama_kategori').addEventListener('input', function() {
            const name = this.value;
            const slug = name.toLowerCase()
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .trim('-');
            document.getElementById('slug_kategori').value = slug;
        });
    }
    
    function setupSearchAndFilters() {
        document.getElementById('search-news').addEventListener('input', debounce(handleSearch, 300));
        document.getElementById('filter-category').addEventListener('change', handleFilter);
        document.getElementById('filter-status').addEventListener('change', handleFilter);
        document.getElementById('filter-date').addEventListener('change', handleFilter);
        
        // Select all checkbox
        document.getElementById('select-all-news').addEventListener('change', handleSelectAll);
    }
    
    function setupImageUpload() {
        const uploadPlaceholder = document.getElementById('upload-placeholder');
        const fileInput = document.getElementById('featured_image');
        const imagePreview = document.getElementById('image-preview');
        const previewImg = document.getElementById('preview-img');
        const removeBtn = document.getElementById('remove-image');
        
        if (uploadPlaceholder && fileInput) {
            uploadPlaceholder.addEventListener('click', () => fileInput.click());
            
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewImg.src = e.target.result;
                        uploadPlaceholder.classList.add('hidden');
                        imagePreview.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            if (removeBtn) {
                removeBtn.addEventListener('click', function() {
                    fileInput.value = '';
                    previewImg.src = '';
                    imagePreview.classList.add('hidden');
                    uploadPlaceholder.classList.remove('hidden');
                });
            }
        }
    }
    
    function loadStatistics() {
        // Load actual statistics from backend
        // TODO: Replace with actual API call
        document.getElementById('total-news').textContent = '0';
        document.getElementById('published-news').textContent = '0';
        document.getElementById('draft-news').textContent = '0';
    }
    
    function loadTabData(tab) {
        switch(tab) {
            case 'list':
                loadNewsData();
                break;
            case 'categories':
                loadCategoriesData();
                break;
            case 'gallery':
                loadMediaData();
                break;
            case 'analytics':
                loadAnalyticsData();
                break;
        }
    }
    
    function loadNewsData() {
        const tableBody = document.getElementById('news-table-body');
        
        // Show loading
        tableBody.innerHTML = '<tr><td colspan="8" class="text-center py-8"><i class="fas fa-spinner fa-spin mr-2"></i>Memuat data...</td></tr>';
        
        // Load actual data from backend
        // TODO: Replace with actual API call
        setTimeout(() => {
            tableBody.innerHTML = '<tr><td colspan="8" class="text-center py-8 text-gray-500">Belum ada data berita. <a href="{% url "news:news_create_view" %}" class="text-blue-600 hover:text-blue-800">Tambah berita pertama</a></td></tr>';
            updatePagination();
        }, 500);
    }
    
    function loadCategoriesData() {
        const grid = document.getElementById('categories-grid');
        
        // Show loading
        grid.innerHTML = '<div class="col-span-full text-center py-8"><i class="fas fa-spinner fa-spin mr-2"></i>Memuat data...</div>';
        
        // Load actual data from backend
        // TODO: Replace with actual API call
        setTimeout(() => {
            grid.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">Belum ada kategori. <a href="{% url "news:news_category_view" %}" class="text-blue-600 hover:text-blue-800">Tambah kategori pertama</a></div>';
        }, 500);
    }
    
    function loadMediaData() {
        const grid = document.getElementById('media-grid');
        
        // Show loading
        grid.innerHTML = '<div class="col-span-full text-center py-8"><i class="fas fa-spinner fa-spin mr-2"></i>Memuat data...</div>';
        
        // Load actual data from backend
        // TODO: Replace with actual API call
        setTimeout(() => {
            grid.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">Belum ada media. <a href="{% url "news:news_media_view" %}" class="text-blue-600 hover:text-blue-800">Upload media pertama</a></div>';
        }, 500);
    }
    
    function loadAnalyticsData() {
        const popularNewsBody = document.getElementById('popular-news-body');
        
        // Show loading
        popularNewsBody.innerHTML = '<tr><td colspan="4" class="text-center py-8"><i class="fas fa-spinner fa-spin mr-2"></i>Memuat data...</td></tr>';
        
        // Load actual data from backend
        // TODO: Replace with actual API call
        setTimeout(() => {
            popularNewsBody.innerHTML = '<tr><td colspan="4" class="text-center py-8 text-gray-500">Belum ada data analitik.</td></tr>';
        }, 500);
    }
    
    // Modal functions
    function openNewsModal(id = null) {
        if (id) {
            // Redirect to edit page
            window.location.href = `{% url 'news:news_edit_view' 0 %}`.replace('0', id);
        } else {
            // Redirect to create page
            window.location.href = '{% url "news:news_create_view" %}';
        }
    }
    
    function closeNewsModal() {
        // Function kept for compatibility but not used
    }
    
    function openCategoryModal(id = null) {
        const modal = document.getElementById('category-modal');
        
        if (id) {
            // Load category data for editing
            loadCategoryForEdit(id);
        } else {
            document.getElementById('category-form').reset();
        }
        
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }
    
    function closeCategoryModal() {
        document.getElementById('category-modal').classList.add('hidden');
        document.body.style.overflow = 'auto';
    }
    
    function openMediaModal() {
        document.getElementById('media-modal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }
    
    function closeMediaModal() {
        document.getElementById('media-modal').classList.add('hidden');
        document.body.style.overflow = 'auto';
    }
    
    function openDeleteModal(id, type) {
        window.deleteId = id;
        window.deleteType = type;
        document.getElementById('delete-modal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }
    
    function closeDeleteModal() {
        document.getElementById('delete-modal').classList.add('hidden');
        document.body.style.overflow = 'auto';
        window.deleteId = null;
        window.deleteType = null;
    }
    
    // Form handlers
    function handleNewsSubmit(e) {
        e.preventDefault();
        
        const formData = new FormData(e.target);
        const newsData = Object.fromEntries(formData.entries());
        
        // Simulate API call
        showNotification('Berita berhasil disimpan!', 'success');
        closeNewsModal();
        loadNewsData();
        loadStatistics();
    }
    
    function handleCategorySubmit(e) {
        e.preventDefault();
        
        const formData = new FormData(e.target);
        const categoryData = Object.fromEntries(formData.entries());
        
        // Simulate API call
        showNotification('Kategori berhasil disimpan!', 'success');
        closeCategoryModal();
        loadCategoriesData();
    }
    
    function handleMediaSubmit(e) {
        e.preventDefault();
        
        const formData = new FormData(e.target);
        
        // Simulate upload progress
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const uploadProgress = document.getElementById('upload-progress');
        
        uploadProgress.classList.remove('hidden');
        
        let progress = 0;
        const interval = setInterval(() => {
            progress += 10;
            progressBar.style.width = progress + '%';
            progressText.textContent = progress + '%';
            
            if (progress >= 100) {
                clearInterval(interval);
                setTimeout(() => {
                    showNotification('Media berhasil diupload!', 'success');
                    closeMediaModal();
                    loadMediaData();
                    uploadProgress.classList.add('hidden');
                    progressBar.style.width = '0%';
                    progressText.textContent = '0%';
                }, 500);
            }
        }, 200);
    }
    
    // Search and filter functions
    function handleSearch() {
        const searchTerm = document.getElementById('search-news').value.toLowerCase();
        // Implement search logic
        loadNewsData();
    }
    
    function handleFilter() {
        // Implement filter logic
        loadNewsData();
    }
    
    function handleSelectAll(e) {
        const checkboxes = document.querySelectorAll('input[type="checkbox"][value]');
        checkboxes.forEach(checkbox => {
            checkbox.checked = e.target.checked;
            toggleSelection(parseInt(checkbox.value));
        });
        
        updateBulkActionsVisibility();
    }
    
    function toggleSelection(id) {
        const index = selectedItems.indexOf(id);
        if (index > -1) {
            selectedItems.splice(index, 1);
        } else {
            selectedItems.push(id);
        }
        
        updateBulkActionsVisibility();
    }
    
    function updateBulkActionsVisibility() {
        const bulkBtn = document.getElementById('bulk-actions-btn');
        if (selectedItems.length > 0) {
            bulkBtn.classList.remove('hidden');
        } else {
            bulkBtn.classList.add('hidden');
        }
    }
    
    // Utility functions
    function updatePagination() {
        document.getElementById('showing-start').textContent = '0';
        document.getElementById('showing-end').textContent = '0';
        document.getElementById('total-records').textContent = '0';
        
        const pageNumbers = document.getElementById('page-numbers');
        pageNumbers.innerHTML = '<span class="text-gray-500 text-sm">Tidak ada data</span>';
    }
    
    function changePage(page) {
        currentPage = page;
        loadNewsData();
    }
    
    function exportData(format) {
        showNotification(`Export ${format.toUpperCase()} sedang diproses...`, 'info');
        // Implement export logic
    }
    
    function viewNews(id) {
        // Open news in new tab or modal
        window.open(`/news/${id}`, '_blank');
    }
    
    function duplicateNews(id) {
        showNotification('Berita berhasil diduplikasi!', 'success');
        loadNewsData();
    }
    
    function editCategory(id) {
        openCategoryModal(id);
    }
    
    function viewMedia(id) {
        // Open media viewer modal
        showNotification('Fitur preview media akan segera tersedia', 'info');
    }
    
    function confirmDelete() {
        const id = window.deleteId;
        const type = window.deleteType;
        
        // Simulate API call
        showNotification(`${type === 'news' ? 'Berita' : type === 'category' ? 'Kategori' : 'Media'} berhasil dihapus!`, 'success');
        closeDeleteModal();
        
        // Reload appropriate data
        if (type === 'news') {
            loadNewsData();
            loadStatistics();
        } else if (type === 'category') {
            loadCategoriesData();
        } else if (type === 'media') {
            loadMediaData();
        }
    }
    
    function loadNewsForEdit(id) {
        // Simulate loading news data
        const sampleData = {
            judul_berita: 'Pembangunan Jalan Desa Tahap 2 Dimulai',
            slug_berita: 'pembangunan-jalan-desa-tahap-2-dimulai',
            ringkasan_berita: 'Pembangunan jalan desa tahap 2 telah dimulai dengan target selesai dalam 3 bulan.',
            konten_berita: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit...',
            kategori_berita: 'pembangunan',
            status_berita: 'published',
            tags_berita: 'pembangunan, infrastruktur, jalan'
        };
        
        Object.keys(sampleData).forEach(key => {
            const element = document.getElementById(key);
            if (element) {
                element.value = sampleData[key];
            }
        });
    }
    
    function loadCategoryForEdit(id) {
        // Simulate loading category data
        const sampleData = {
            nama_kategori: 'Pembangunan',
            slug_kategori: 'pembangunan',
            deskripsi_kategori: 'Informasi pembangunan infrastruktur desa',
            warna_kategori: '#F59E0B',
            icon_kategori: 'fas fa-hammer'
        };
        
        Object.keys(sampleData).forEach(key => {
            const element = document.getElementById(key);
            if (element) {
                element.value = sampleData[key];
            }
        });
    }
    
    function resetImagePreview() {
        const featuredInput = document.getElementById('featured_image');
        const additionalInput = document.getElementById('additional_images');
        const previewImg = document.getElementById('preview-img');
        const imagePreview = document.getElementById('image-preview');
        const uploadPlaceholder = document.getElementById('upload-placeholder');
        const additionalPreview = document.getElementById('additional-images-preview');
        
        if (featuredInput) featuredInput.value = '';
        if (additionalInput) additionalInput.value = '';
        if (previewImg) previewImg.src = '';
        if (imagePreview) imagePreview.classList.add('hidden');
        if (uploadPlaceholder) uploadPlaceholder.classList.remove('hidden');
        if (additionalPreview) {
            additionalPreview.innerHTML = '';
            additionalPreview.classList.add('hidden');
        }
        
        // Reset Summernote content
        if ($('.summernote').length) {
            $('.summernote').summernote('reset');
        }
    }
    
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
    
    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `fixed top-4 right-4 z-50 p-4 rounded-md shadow-lg ${
            type === 'success' ? 'bg-green-500 text-white' :
            type === 'error' ? 'bg-red-500 text-white' :
            type === 'warning' ? 'bg-yellow-500 text-white' :
            'bg-blue-500 text-white'
        }`;
        notification.innerHTML = `
            <div class="flex items-center">
                <i class="fas ${
                    type === 'success' ? 'fa-check-circle' :
                    type === 'error' ? 'fa-exclamation-circle' :
                    type === 'warning' ? 'fa-exclamation-triangle' :
                    'fa-info-circle'
                } mr-2"></i>
                <span>${message}</span>
                <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            if (notification.parentElement) {
                notification.remove();
            }
        }, 5000);
    }
</script>
{% endblock %}class